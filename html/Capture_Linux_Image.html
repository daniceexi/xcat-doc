<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
</head>
<body>
<div id="TOC">
<ul>
<li><a href="#how-to-capture-image-from-the-running-diskful-linux-node">How To Capture Image from the Running Diskful Linux Node</a><ul>
<li><a href="#prepare-one-diskful-linux-node">Prepare one diskful Linux node</a></li>
<li><a href="#prepare-the-configuration-files">Prepare the configuration files</a><ul>
<li><a href="#the-.pkglist-.exlist-and-.postinstall-files">The .pkglist, .exlist and .postinstall files</a></li>
<li><a href="#the-exlist-file">The exlist file</a></li>
</ul></li>
</ul></li>
<li><a href="#define-the-osimage-object-optional">Define the osimage object (Optional)</a></li>
<li><a href="#run-imgcapture">Run imgcapture</a></li>
<li><a href="#the-usage-of-imgcapture-and-examples">The usage of imgcapture and examples</a></li>
<li><a href="#generate-statelessstatelite-images">Generate stateless/statelite images</a><ul>
<li><a href="#generate-stateless-images">Generate stateless images</a></li>
<li><a href="#generate-statelite-images">Generate statelite images</a></li>
</ul></li>
<li><a href="#set-the-node-status-ready-for-network-boot">Set the node status ready for network boot</a></li>
<li><a href="#notes">Notes</a></li>
</ul>
</div>
<p><!-- START doctoc generated TOC please keep comment here to allow auto update --> <!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --> Table of Contents</p>
<ul>
<li><a href="#how-to-capture-image-from-the-running-diskful-linux-node">How To Capture Image from the Running Diskful Linux Node</a></li>
<li><a href="#prepare-one-diskful-linux-node">Prepare one diskful Linux node</a></li>
<li><a href="#prepare-the-configuration-files">Prepare the configuration files</a>
<ul>
<li><a href="#the-pkglist-exlist-and-postinstall-files">The .pkglist, .exlist and .postinstall files</a></li>
<li><a href="#the-exlist-file">The exlist file</a></li>
</ul></li>
<li><a href="#define-the-osimage-object-optional">Define the osimage object (Optional)</a></li>
<li><a href="#run-imgcapture">Run imgcapture</a></li>
<li><a href="#the-usage-of-imgcapture-and-examples">The usage of imgcapture and examples</a></li>
<li><a href="#generate-statelessstatelite-images">Generate stateless/statelite images</a></li>
<li><a href="#generate-stateless-images">Generate stateless images</a></li>
<li><a href="#generate-statelite-images">Generate statelite images</a></li>
<li><a href="#set-the-node-status-ready-for-network-boot">Set the node status ready for network boot</a></li>
<li><a href="#notes">Notes</a></li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->


<h2 id="how-to-capture-image-from-the-running-diskful-linux-node"><a href="#TOC">How To Capture Image from the Running Diskful Linux Node</a></h2>
<p>xCAT provides the <strong>imgcapture</strong> command to capture an OS image from a running diskful Linux node, and prepares the rootimg directory, kernel and initial ramdisks for <strong>liteimg</strong>/<strong>packimage</strong> to generate the statelite/stateless rootimg.</p>
<p>This command is very helpful, especially when there's already one diskful Linux node in which all the necessary applications are installed and configured, or the user needs to migrate the diskful environment to the diskless environment (including <strong>statelite</strong>/<strong>stateless</strong>).</p>
<p>See man page <a href="http://xcat.sourceforge.net/man1/imgcapture.1.html">imgcapture</a>.</p>
<p>The following are the steps to capture image.</p>
<h3 id="prepare-one-diskful-linux-node"><a href="#TOC">Prepare one diskful Linux node</a></h3>
<p>The diskful Linux node to be captured must be managed by the xCAT MN, and the remote shell between the xCAT MN and this node must be configured.</p>
<h3 id="prepare-the-configuration-files"><a href="#TOC">Prepare the configuration files</a></h3>
<h4 id="the-.pkglist-.exlist-and-.postinstall-files"><a href="#TOC">The .pkglist, .exlist and .postinstall files</a></h4>
<p>The following files will be used by the <strong>imgcapture</strong> command. And, they work the same as when genimage command is running. Refer to <a href="XCAT_iDataPlex_Cluster_Quick_Start/#deploying-stateless-nodes">Deploying Stateless Nodes</a> to see how to configure these files.</p>
<pre><code>  &lt;profile&gt;.&lt;osver&gt;.&lt;arch&gt;.pkglist
  &lt;profile&gt;.&lt;osver&gt;.&lt;arch&gt;.exlist
  &lt;profile&gt;.&lt;osver&gt;.&lt;arch&gt;.postinstall</code></pre>
<h4 id="the-exlist-file"><a href="#TOC">The exlist file</a></h4>
<p>The file is named:</p>
<pre><code>   &lt;profile&gt;.&lt;osver&gt;.&lt;arch&gt;.imgcapture.exlist file</code></pre>
<p>During <strong>imgcapture</strong> is running, the user might need to exlude some files/directories from the image to be captured.</p>
<p>xCAT provides the &lt;profile&gt;.&lt;osver&gt;&lt;arch&gt;.imgcapture.exlist configuration file, the user can add any files/directories into this file.</p>
<p>For example, there's one directory (/root/test/), which should be excluded from the image to be captured, the user can add the following line into the &lt;profile&gt;.&lt;osver&gt;.&lt;arch&gt;.imgcapture.exlist file:</p>
<pre><code>     ./root/test*</code></pre>
<h2 id="define-the-osimage-object-optional"><a href="#TOC">Define the osimage object (Optional)</a></h2>
<p>If the image to be captured needs to be associated with one specific osimage object, you can use the existing osimage objects, or you can use the</p>
<pre><code>    chdef -t osimage -o &lt;osimgname&gt; .... command to set the attributes for &lt;osimgname&gt;.</code></pre>
<h2 id="run-imgcapture"><a href="#TOC">Run imgcapture</a></h2>
<h2 id="the-usage-of-imgcapture-and-examples"><a href="#TOC">The usage of imgcapture and examples</a></h2>
<p>See man page <a href="http://xcat.sourceforge.net/man1/imgcapture.1.html">imgcapture</a>.</p>
<h2 id="generate-statelessstatelite-images"><a href="#TOC">Generate stateless/statelite images</a></h2>
<p>After the image (rootimg), kernel (kernel) and initial ramdisks (initrd-stateless.gz and initrd-statelite.gz)has been generated and put into $installroot/netboot/&lt;osver&gt;/&lt;arch&gt;/&lt;profile&gt;/, you can customize the image by running <strong>packimage</strong>/<strong>liteimg</strong> with the options you want.</p>
<h3 id="generate-stateless-images"><a href="#TOC">Generate stateless images</a></h3>
<p>Run packimage:</p>
<pre><code>     packimage &lt;osimagename&gt;</code></pre>
<p>For more info about packimage, please refer to the manpage of packimage.</p>
<h3 id="generate-statelite-images"><a href="#TOC">Generate statelite images</a></h3>
<p>Run liteimg:</p>
<pre><code>     liteimg &lt;osimagename&gt;</code></pre>
<p>For more info about liteimg, please refer to the manpage of liteimg.</p>
<h2 id="set-the-node-status-ready-for-network-boot"><a href="#TOC">Set the node status ready for network boot</a></h2>
<p>Run nodeset to set the node status ready for network boot.</p>
<pre><code>     nodeset node1 netboot</code></pre>
<p>Or:</p>
<pre><code>     nodeset node1 statelite</code></pre>
<p>Or:</p>
<pre><code>     nodeset node1 osimage=&lt;osimagename&gt;</code></pre>
<h2 id="notes"><a href="#TOC">Notes</a></h2>
<p>If the node is set to stateless or RAMdisk-based statelite status, before booting the node up, please make sure the node has enough memory capabilities. In order to boot up the LPAR with the redhat6/PPC64 Linux image, the node should have about 5120MB memory.</p>
</body>
</html>
