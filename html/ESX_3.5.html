<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
</head>
<body>
<div id="TOC">
<ul>
<li><a href="#xcat-esx">xCAT &amp; ESX</a></li>
<li><a href="#install-esx-hypervisor">1. Install ESX Hypervisor</a><ul>
<li><a href="#copycds">1.1. Copycds</a></li>
<li><a href="#set-up-kickstart-file-stuff">1.2. Set up kickstart file stuff</a><ul>
<li><a href="#esx.tmpl"><strong>1.2.1 esx.tmpl</strong></a></li>
<li><a href="#post.esx"><strong>1.2.2 post.esx</strong></a></li>
<li><a href="#setupesx"><strong>1.2.3 setupesx</strong></a></li>
</ul></li>
<li><a href="#more-management-node-setup">1.3 More management node setup</a></li>
<li><a href="#table-setup-and-install">1.4. Table Setup and install</a></li>
</ul></li>
<li><a href="#vmware-image-setup">VMware Image Setup</a></li>
<li><a href="#miscellanious-fun">Miscellanious Fun</a></li>
</ul>
</div>
<p><!-- START doctoc generated TOC please keep comment here to allow auto update --> <!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --> Table of Contents</p>
<ul>
<li><a href="#xcat-&amp;amp-esx">xCAT &amp; ESX</a></li>
<li><a href="#1%5C-install-esx-hypervisor">1. Install ESX Hypervisor</a></li>
<li><a href="#11-copycds">1.1. Copycds</a></li>
<li><a href="#12-set-up-kickstart-file-stuff">1.2. Set up kickstart file stuff</a>
<ul>
<li><a href="#121-esxtmpl"><strong>1.2.1 esx.tmpl</strong></a></li>
<li><a href="#122-postesx"><strong>1.2.2 post.esx</strong></a></li>
<li><a href="#123-setupesx"><strong>1.2.3 setupesx</strong></a></li>
</ul></li>
<li><a href="#13-more-management-node-setup">1.3 More management node setup</a></li>
<li><a href="#14-table-setup-and-install">1.4. Table Setup and install</a></li>
<li><a href="#vmware-image-setup">VMware Image Setup</a></li>
<li><a href="#miscellanious-fun">Miscellanious Fun</a></li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->


<h1 id="xcat-esx"><a href="#TOC">xCAT &amp; ESX</a></h1>
<p>You can install ESX with xCAT. This covers ESX 3.5</p>
<h1 id="install-esx-hypervisor"><a href="#TOC">1. Install ESX Hypervisor</a></h1>
<p>It requires a few changes. First, you'll need to copy the Media, then create a suitable kickstart file and then do post install scripts. The following article shows you how.</p>
<h2 id="copycds"><a href="#TOC">1.1. Copycds</a></h2>
<pre><code>copycds -n rh esx*.iso</code></pre>
<p>This will copy the ESX ISO into /install/rh/x86</p>
<h2 id="set-up-kickstart-file-stuff"><a href="#TOC">1.2. Set up kickstart file stuff</a></h2>
<h3 id="esx.tmpl"><a href="#TOC"><strong>1.2.1 esx.tmpl</strong></a></h3>
<p>The latest release of xCAT comes with an esx.tmpl. You can download it <a href="http://xcat.svn.sourceforge.net/viewvc/xcat/xcat-core/trunk/xCAT-server/share/xcat/install/rh/esx.tmpl">here</a> if its not in your version of xCAT and save it to:</p>
<pre><code>/opt/xcat/share/xcat/install/rh/esx.tmpl</code></pre>
<h3 id="post.esx"><a href="#TOC"><strong>1.2.2 post.esx</strong></a></h3>
<p>You'll also need to make sure that you have:</p>
<pre><code>/opt/xcat/share/xcat/install/scripts/post.esx</code></pre>
<p>If you don't have it get it <a href="http://xcat.svn.sourceforge.net/viewvc/xcat/xcat-core/trunk/xCAT-server/share/xcat/install/scripts/post.esx">here</a>.</p>
<h3 id="setupesx"><a href="#TOC"><strong>1.2.3 setupesx</strong></a></h3>
<p>Verify that you have:</p>
<pre><code>/install/postscripts/setupesx</code></pre>
<p>If you don't you can get it <a href="http://xcat.svn.sourceforge.net/viewvc/xcat/xcat-core/trunk/xCAT/postscripts/setupesx">here</a>.<br />If you are installing over eth0 then this script should work as is. If you change it to eth1 or want to set up other virtual interfaces then you should edit that file. You may need to do some experiments with it. Good luck.</p>
<h2 id="more-management-node-setup"><a href="#TOC">1.3 More management node setup</a></h2>
<p>Make sure that /install is exported via NFS for post scripts to run. This is not done by xCAT by default since installations are done with HTTP. The postscripts use stunnel which are not available in ESX3.5, hence the post install is a little different.</p>
<p>If you have a shared NFS filesystem, you may want to put that in the post install script as well.</p>
<p>Note that the xCAT postscripts standard do not work in this setup. Any changes to post scripts should be done in post.esx or in setupesx. You should also take note that many scripts don't run until the VMware kernel boots up the first time.</p>
<p>Another thing I've noticed is that if I have the serial port in nodehm table I sometimes have problems with hangs during install.</p>
<h2 id="table-setup-and-install"><a href="#TOC">1.4. Table Setup and install</a></h2>
<p>Most of your tables will be set up normally. The only difference is the nodetype table. Ours looks like this:</p>
<pre><code>#node,os,arch,profile,nodetype,comments,disable
&quot;compute&quot;,&quot;rh&quot;,&quot;x86&quot;,&quot;esx&quot;</code></pre>
<p>Now you can install it:</p>
<pre><code>rinstall &amp;lt;node&amp;gt; -o rh -a x86 -p esx</code></pre>
<p>Now provided everything else is setup correctly, you can do an rinstall and install ESX 3.5 and have ssh setup for provisioning virtual machines.</p>
<h1 id="vmware-image-setup"><a href="#TOC">VMware Image Setup</a></h1>
<p>TODO!!!</p>
<h1 id="miscellanious-fun"><a href="#TOC">Miscellanious Fun</a></h1>
<p>Once ESX is installed on your machines, you are ready to install virtual machines. I recommend that you make your virtual machines have static IP addresses.<br />VMware shows the range that static generated IP addresses can have:</p>
<p>Generate a ton of static IP addresses as follows:</p>
<pre><code>use strict;

# give a node and generate a mac address for it.

my $nr = shift;
my @nodes = `nodels $nr`;

foreach my $node (@nodes) {
        my $X = (int(rand(63)));
        # between 00 and 3F


        # between 00 and FF
        my $Y = (int(rand(255)));

        #between 00 and FF
        my $Z = (int(rand(255)));


        chomp($node);
        my $d = sprintf (&quot;$node,eth0,00:50:56:%02x:%02x:%02x&quot;, $X,$Y,$Z);
        print &quot;$d\n&quot;;
}</code></pre>
<p>I ran that and added that to my mac table.<br />Here's how I generated a bunch of vnc ports:</p>
<pre><code>for j in $(seq 98); do P=5901; for i in $(nodels esx$j); do echo &quot;$i,,,,$P&quot;; P=$(expr $P + 1); done; done</code></pre>
<p>.</p>
</body>
</html>
