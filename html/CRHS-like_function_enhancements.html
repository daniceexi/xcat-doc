<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
</head>
<body>
<div id="TOC">
<ul>
<li><a href="#planning">1. Planning</a><ul>
<li><a href="#information-about-the-example-used-in-this-design">1.1 Information About the Example Used in This Design</a></li>
<li><a href="#planning-for-hostnames-and-ip-addresses">1.2 Planning for hostnames and ip addresses</a></li>
<li><a href="#planning-for-mapping-between-the-hostnames-and-physical-hardware-components">1.3 Planning for mapping between the hostnames and physical hardware components</a></li>
</ul></li>
<li><a href="#setup-dhcp-server-on-mn">2. Setup DHCP server on MN</a></li>
<li><a href="#power-on-all-the-frames-and-cecs">3. Power on all the frames and CECs</a></li>
<li><a href="#update-xcat-tables">4. Update xCAT tables</a><ul>
<li><a href="#update-the-mapping-between-hostnames-and-ip-addresses">4.1 Update the mapping between hostnames and ip addresses</a><ul>
<li><a href="#update-nodelist-table">4.1.1 Update nodelist table</a></li>
<li><a href="#update-hosts-tableoptional">4.1.2 Update hosts table(optional)</a></li>
</ul></li>
<li><a href="#update-the-mapping-between-the-hostnames-and-the-physical-hardware-components">4.2 Update the mapping between the hostnames and the physical hardware components</a><ul>
<li><a href="#use-switch-port-information">4.2.1 Use switch port information</a></li>
<li><a href="#use-vpd-information">4.2.2 Use vpd information</a></li>
</ul></li>
</ul></li>
<li><a href="#discover-the-hmcs-fsps-and-bpas">5. Discover the HMCs, FSPs and BPAs</a><ul>
<li><a href="#random-ip-address">5.1 Random ip address</a><ul>
<li><a href="#use-stanza-file">5.1.1 Use stanza file</a></li>
<li><a href="#update-xcat-database-directly">5.1.2 Update xCAT database directly</a></li>
</ul></li>
<li><a href="#permanent-ip-addresses">5.2 Permanent ip addresses</a><ul>
<li><a href="#use-stanza-file-1">5.2.1 Use stanza file</a></li>
<li><a href="#update-xcat-database-directly-1">5.2.2 Update xCAT database directly</a></li>
</ul></li>
</ul></li>
<li><a href="#connect-fsps-and-bpas-to-hmc">6. Connect FSPS and BPAs to HMC</a></li>
<li><a href="#set-initial-password-for-fspbpa-if-they-are-brand-new-machines">7. Set initial password for FSP/BPA if they are brand new machines</a></li>
<li><a href="#run-rspconfig-to-setup-the-frame-numbers">8. Run rspconfig to setup the frame numbers</a></li>
<li><a href="#run-rspconfig-to-setup-hostnames-on-the-fsps-and-bpas">9. Run rspconfig to setup hostnames on the FSPs and BPAs</a></li>
<li><a href="#others">10. Others</a></li>
</ul>
</div>
<p><!-- START doctoc generated TOC please keep comment here to allow auto update --> <!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --> Table of Contents</p>
<ul>
<li><a href="#1%5C-planning">1. Planning</a></li>
<li><a href="#11-information-about-the-example-used-in-this-design">1.1 Information About the Example Used in This Design</a></li>
<li><a href="#12-planning-for-hostnames-and-ip-addresses">1.2 Planning for hostnames and ip addresses</a></li>
<li><a href="#13-planning-for-mapping-between-the-hostnames-and-physical-hardware-components">1.3 Planning for mapping between the hostnames and physical hardware components</a></li>
<li><a href="#2%5C-setup-dhcp-server-on-mn">2. Setup DHCP server on MN</a></li>
<li><a href="#3%5C-power-on-all-the-frames-and-cecs">3. Power on all the frames and CECs</a></li>
<li><a href="#4%5C-update-xcat-tables">4. Update xCAT tables</a></li>
<li><a href="#41-update-the-mapping-between-hostnames-and-ip-addresses">4.1 Update the mapping between hostnames and ip addresses</a>
<ul>
<li><a href="#411-update-nodelist-table">4.1.1 Update nodelist table</a></li>
<li><a href="#412-update-hosts-tableoptional">4.1.2 Update hosts table(optional)</a></li>
</ul></li>
<li><a href="#42-update-the-mapping-between-the-hostnames-and-the-physical-hardware-components">4.2 Update the mapping between the hostnames and the physical hardware components</a>
<ul>
<li><a href="#421-use-switch-port-information">4.2.1 Use switch port information</a></li>
<li><a href="#422-use-vpd-information">4.2.2 Use vpd information</a></li>
</ul></li>
<li><a href="#5%5C-discover-the-hmcs-fsps-and-bpas">5. Discover the HMCs, FSPs and BPAs</a></li>
<li><a href="#51-random-ip-address">5.1 Random ip address</a>
<ul>
<li><a href="#511-use-stanza-file">5.1.1 Use stanza file</a></li>
<li><a href="#512-update-xcat-database-directly">5.1.2 Update xCAT database directly</a></li>
</ul></li>
<li><a href="#52-permanent-ip-addresses">5.2 Permanent ip addresses</a>
<ul>
<li><a href="#521-use-stanza-file">5.2.1 Use stanza file</a></li>
<li><a href="#522-update-xcat-database-directly">5.2.2 Update xCAT database directly</a></li>
</ul></li>
<li><a href="#6%5C-connect-fsps-and-bpas-to-hmc">6. Connect FSPS and BPAs to HMC</a></li>
<li><a href="#7%5C-set-initial-password-for-fspbpa-if-they-are-brand-new-machines">7. Set initial password for FSP/BPA if they are brand new machines</a></li>
<li><a href="#8%5C-run-rspconfig-to-setup-the-frame-numbers">8. Run rspconfig to setup the frame numbers</a></li>
<li><a href="#9%5C-run-rspconfig-to-setup-hostnames-on-the-fsps-and-bpas">9. Run rspconfig to setup hostnames on the FSPs and BPAs</a></li>
<li><a href="#10%5C-others">10. Others</a></li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->

<p>{{:Design Warning}}</p>
<h2 id="planning"><a href="#TOC">1. Planning</a></h2>
<h3 id="information-about-the-example-used-in-this-design"><a href="#TOC">1.1 Information About the Example Used in This Design</a></h3>
<p>In this design, we use an example cluster for simplicity. The example cluster has 16 IH frames, in each frame there are 16 IH machines. Assume user design their machine as following:</p>
<p><strong>name:</strong></p>
<p>frame name: frame1a is the A side of BPA in frame #1, and frame1b is the B side of BPA in frame #1, and so on.</p>
<p>CEC name: from f1c1-f1c16 (in frame1) to f16c1-f16c16 (in frame 16)</p>
<p>HMC name: the frame1 through frame 8 are managed by hmc1(10.0.0.101), the frame 9 through frame 16 are managed by hmc2(10.0.0.102)</p>
<p>group name: group fsp will be used to represent all CEC nodes, and group bpa will represent all fram nodes. To make the regular expression in xCAT DB easier, I'd like to add 2 more groups for BPA nodes: bpa-a will be used to represent all BPA side A nodes, and bpa-b will be used for all BPA side B nodes.</p>
<p><strong>network:</strong></p>
<p>the service network will be running with IP addresses in subnet 10.0.0.0/255.255.0.0. But the 172.20.0.0/255.255.0.0 will be used for the random ip addresses assigned to all the FSPs/BPAs in the first power on process.</p>
<p>The IP of core switch in service network is 10.0.0.254.</p>
<p>frame #1 will be connected to port 1 on the core switch, with port name &quot;Gi1/1&quot;, frame #2 will to connected to &quot;Gi1/2&quot;, and so on.</p>
<p>The 2 sides of BPA in frame1 will get IP from DHCP (on xCAT MN): 10.0.1.1/10.0.1.2, 2 sides of BPA in frame2 will get 10.2.1.3/10.2.1.4, and so on.</p>
<p>FSPs in frame #1 will get IP from 10.0.2.1 to 10.0.2.16, FSP in frame #2 will get IP from 10.0.2.17 to 10.0.2.32</p>
<p>xCAT MN will be connected to service network with IP 10.0.0.1 (eth0).</p>
<p>Note: In the examples throughout this design, node groups and regular expressions are used, you can specify any separate nodes and specific attributes for the nodes.</p>
<h3 id="planning-for-hostnames-and-ip-addresses"><a href="#TOC">1.2 Planning for hostnames and ip addresses</a></h3>
<p>For xCAT hardware discovery feature, the prerequisite information is the hostnames and ip addresses allocation for all the FSPs and BPAs. The mapping between hostnames and ip addresses and the mapping between hostnames and physical hardware components has to be settled down before proceeding with the xCAT hardware discovery function.</p>
<p>Note: If it is a migration scenario such as migrating the CSM CRHS environment to xCAT and it is OK for you to use the default FSP/BPA host names, i.e., Server-&lt;Model&gt;-&lt;Type&gt;-&lt;SerialNumber&gt;-&lt;Side&gt;, then all the steps in &quot;Planning&quot; section are not necessary at all, you can skip all the steps in sections &quot;Planning&quot;. If the FSPs and BPAs already have static ip addresses, then all the steps in &quot;Setup DHCP server on MN&quot; section are not necessary, you can skip all the steps in sections &quot;Setup DHCP server on MN&quot;. All the HMC connections have to be cleaned up and all the HMCs have to be changed back to standalone mode before proceeding with the xCAT hardware discovery.</p>
<p>Each FSP side and BPA side should have one ip address assigned, and Each ip address should have a hostname defined, the FSPs and BPAs are indexed by hostnames.</p>
<p>The ip addresses for FSPs and BPAs are got from the DHCP server on xCAT management node, the DHCP service process in the hardware discovery is a little bit complex, there are two types of ip addresses allocation mechanism that can be used in the hardware discovery process: random ip addresses or permanent ip addresses.</p>
<p>DHCP service can be configured to use dynamic ip range in the DHCP configuration file, or use the MAC addresses and ip addresses mapping in leases file. When using dynamic ip range, each DHCP client will be assigned a random ip address at first, after that, the previous ip address and the lease expire information will be used to determine if the DHCP client will get a new ip address when the DHCP client restarts. When using MAC addresses and ip addresses mapping in DHCP leases file, each DHCP client will get a specific ip address, we call it permanent ip address, if the DHCP client MAC address and ip address mapping is configured in the DHCP leases file, after that, the DHCP client will get the same ip address upon each restart.</p>
<p><strong>Random ip addresses:</strong> When the FSPs and BPAs are brought up first time, since the MAC addresses for the FSPs and BPAs are not known yet, we can not specify the MAC address and ip address mapping in DHCP leases file, we can only specify a dynamic ip range in DHCP configuration file, so each FSP or BPA will get a random ip address. As mentioned above, the random ip address for each FSP or BPA may change in the future when the DHCP client on FSP or BPA restarts, however, if we specify a large enough dynamic ip range to aviod the ip addresses reuse, the random ip addresses can be similar as &quot;permanent&quot; ones. This solution has been validated in CSM CRHS solution. So the random ip address solution should be able to work. Please be aware that using the random DHCP ip addresses will increase the maintainance effort because you do not exactly know which hardware component has which ip address, at the same time, using random DHCP ip addresses opens an error windows that the FSPs/BPAs ip addresses may be changed during the FSPs/BPAs reboot, the FSPs/BPAs ip addresses change will result in HMC connection lost then you have to do some manual steps to recover. However, the random DHCP ip addresses solution should be able to work well for most of the scenarios, CSM CRHS has been using this solution for a long while.</p>
<p><strong>Permanent ip addresses:</strong> the permanent ip addresses is clearer and easier to mantain, to achieve the permanent ip addresses goal, a method is to specify the MAC address and ip address mapping for each FSP and BPA in the DHCP leases file. Of course, getting the MAC address for each FSP and BPA is complex and time consuming unless the FSPs and BPAs have already got ip addresses from DHCP server, then we can simply ping the ip addresses and the mac addresses will be added to the arp cache. lsslp will collect the mac address and add the ip address mapping into DHCP leases file.</p>
<p>Either the solution &quot;Random ip addresses&quot; or solution &quot;Permanent ip addresses&quot; can be used, the administrator needs to select one solution as the ip addresses assignment mechanism.</p>
<p>The HMC host names should be resolvable through /etc/hosts or DNS before proceeding with the hardware discovery process.</p>
<h3 id="planning-for-mapping-between-the-hostnames-and-physical-hardware-components"><a href="#TOC">1.3 Planning for mapping between the hostnames and physical hardware components</a></h3>
<p>Several tables need to be updated to specify the mapping between the hostnames and physical hardware components, the mapping will tell xCAT on which physical hardware component the hostname is referring to. For example, the hostname f1c1 can be actually pointing to the CEC 9125-F2A-SN027ACB4, or pointing to the CEC with cage id 3 connected to the first port in the core switch.</p>
<p>xCAT currently supports two ways to specify the mapping between the hostnames and physical hardware compoents: switch port and vpd. You can select either of the methods based on your cluster configuration; if you understand the network connections very well for each FSPs/BPAs and the switch supports SNMP protocol, use the switch port method is a good choice. If you do not quite understand the network connections or the switch does not support SNMP well, then using vpd information is another chioce for you</p>
<h2 id="setup-dhcp-server-on-mn"><a href="#TOC">2. Setup DHCP server on MN</a></h2>
<p>The DHCP service process in the hardware discovery is a little bit complex. All the FSPs and BPAs ip addresses are obtained from DHCP server on xCAT management node or standalone DHCP server, and the ip addresses tend to be changed dynamiclly. The floating FSP/BPA ip addresses are hard to maintain and error prone, so a better solution is to use the permanent ip addresses, the permanent ip addresses is clearer and easier to mantain.</p>
<p>The method that system x hardware discovery feature is being used can work for system p also, before the FSPs and BPAs first power on, an ip addresses range will be added into dhcpd.conf or dhcpsd.conf file, during the FSPs and BPAs first power on, the FSPs and BPAs will get floating ip addresses, then lsslp command will get the mac addresses for all the FSPs and BPAs and writes the ip addresses and mac addresses mapping information into DHCP leases file, after that, lsslp log in the ASMI and restart the network interfaces for all the FSPs and CECs then all the FSPs and BPAs will get permanent ip addresses.</p>
<p>To avoid confliction between the &quot;random ip addresses&quot; and &quot;permanent ip addresses&quot;, two separate subnets can be used. In this design, we will use subnet 172.20.0.0/255.255.0.0 for the floating ip addresses and use subnet 10.0.0.0/255.255.0.0 for the permanent ip addresses.</p>
<p>So the process will be:</p>
<p>1. Update the networks table to include the floating ip addresses range:</p>
<pre><code>#netname,net,mask,mgtifname,gateway,dhcpserver,tftpserver,nameservers,ntpservers,logservers,dynamicrange,nodehostname,comments,disable
randomipnet, &quot;172.0.0.0&quot;,&quot;255.255.0.0&quot;,&quot;eth0:0&quot;,,&quot;172.20.0.1&quot;,,,,,&quot;172.20.0.2-172.20.0.254&quot;,,,
svcnet,&quot;10.0.0.0&quot;,&quot;255.255.0.0&quot;,&quot;eth0&quot;,,&quot;10.0.0.1&quot;,,,,,,,,</code></pre>
<p>If the random ip addresses solution is selected, the &quot;randomipnet&quot; is not necessary in the &quot;networks&quot; table, but the dynamic ip range should be specified for the &quot;svcnet&quot;, here is an example:</p>
<pre><code>#netname,net,mask,mgtifname,gateway,dhcpserver,tftpserver,nameservers,ntpservers,logservers,dynamicrange,nodehostname,comments,disable
svcnet,&quot;10.0.0.0&quot;,&quot;255.255.0.0&quot;,&quot;eth0&quot;,,&quot;10.0.0.1&quot;,,,,,&quot;10.0.1.1-10.0.2.255&quot;,,,</code></pre>
<p>2. If two subnets are needed, we need one ip address from each subnet configured on the management node. Either two separate network interface cards or alias ip addresses on one network interface card could work. Using alias ip address on one network interface card will reduce the configuration complexity. For Linux, the ethx:y can be configured directly to act as the alias ip address for ethx; on AIX, the command chdev -l enx -a alias4=&lt;ipaddress&gt;,&lt;subnet&gt; can be used to configure the alias ip address on enx. Of course, if the random DHCP ip address solution is selected, then this step is not necessary.</p>
<p>3. Run makedhcp to start dhcp server with dynamic IP range</p>
<h2 id="power-on-all-the-frames-and-cecs"><a href="#TOC">3. Power on all the frames and CECs</a></h2>
<p>Power on the frames/CECs manually, since the DHCP server is configured with dynamic ip range, then all the FSPs and BPAs will get floating IP addresses. The floating ip addresses are only for temporary use, the lsslp will use these floating ip addresses for further configuration, so it is not necessary to try to understand which ip addresses are assigned to which FSPs or BPAs.</p>
<h2 id="update-xcat-tables"><a href="#TOC">4. Update xCAT tables</a></h2>
<p>Some information mentioned in the &quot;Planning&quot; section should be added into xCAT tables before running the hardware discovery. The information includes the node names, the mapping between the ip addresses and hostnames, the mapping between the hostnames and the physical hardware components.</p>
<h3 id="update-the-mapping-between-hostnames-and-ip-addresses"><a href="#TOC">4.1 Update the mapping between hostnames and ip addresses</a></h3>
<h4 id="update-nodelist-table"><a href="#TOC">4.1.1 Update nodelist table</a></h4>
<p>The &quot;nodelist&quot; table stores all the hostnames and groups information for all the nodes. Before proceeding with the hardware discovery process, the &quot;nodelist&quot; table needs to be updated to include all the FSPs and BPAs hostnames information.</p>
<pre><code>#node,groups,status,appstatus,primarysn,comments,disable
frame1a,&quot;all,bpa,bpa-a&quot;
frame1b,&quot;all,bpa,bpa-b&quot;
... ...
frame16a,&quot;all,bpa,bpa-a&quot;
frame16b,&quot;all,bpa,bpa-b&quot;
f1c1,&quot;all,fsp&quot;
f1c2,&quot;all,fsp&quot;
... ...
f16c16,&quot;all,fsp&quot;</code></pre>
<p>In the nodelist table, each node may have different status and appstatus in the future, so we could not use &quot;groups&quot; in nodelist table, each node has to be listed separately in the nodelist table. It is time consuming to input all the nodes into nodelist table, the mkdef command can be used to add all the nodes nodelist table:</p>
<pre><code>mkdef frame1a-frame16a groups=&quot;all,bpa,bpa-a&quot;
mkdef frame1b-frame16b groups=&quot;all,bpa,bpa-b&quot;
for i in `seq 1 16`;do mkdef f$ic1-f$ic16 groups=&quot;all,fsp&quot;;done</code></pre>
<h4 id="update-hosts-tableoptional"><a href="#TOC">4.1.2 Update hosts table(optional)</a></h4>
<p>The &quot;hosts&quot; table stores the hostnames and ip addresses for all the nodes. For hardware discovery scenario, the hostnames and ip addresses information for all the FSPs and BPAs should be in &quot;hosts&quot; table before proceeding with the hardware discovery process. This step is optional, if you do not want to assign specific ip address to each FSP or BPA and does not care about using the random DHCP ip addresses for all the FSPs and BPAs, the &quot;hosts&quot; table does not need to be updated. Please be aware that using the random DHCP ip addresses will increase the maintainance effort because you do not exactly know which hardware component has which ip address, at the same time, using random DHCP ip addresses opens an error windows that the FSPs/BPAs ip addresses may be changed during the FSPs/BPAs reboot, the FSPs/BPAs ip addresses change will result in HMC connection lost then you have to do some manual steps to recover. However, the random DHCP ip addresses solution should be able to work well for most of the scenarios, CSM CRHS has been using this solution for a long while.</p>
<pre><code>hosts table
#node,ip                              ,hostnames,comments,disable
fsp,  &quot;|\D+(\d+)\D+(\d+)$|10.0.2.((($1-1)*16)+$2)|&quot;
bpa-a,&quot;|\D+(\d+)\D+$|10.0.1.(($1*2-1))|&quot;
bpa-b,&quot;|\D+(\d+)\D+$|10.0.1.(($1*2))|&quot;</code></pre>
<p>Note: If the CECs have two FSPs installed such as the POWER 595 systems, both the two FSPs should be added into the xCAT database. Here is an example:</p>
<pre><code>#node,ip                              ,hostnames,comments,disable
fsp-a,  &quot;|\D+(\d+)\D+(\d+)$|10.0.2.((($1-1)*16)+$2)|&quot;
fsp-b,  &quot;|\D+(\d+)\D+(\d+)$|10.0.2.((($1-1)*16)+$2+1)|&quot;
bpa-a,&quot;|\D+(\d+)\D+$|10.0.1.(($1*2-1))|&quot;
bpa-b,&quot;|\D+(\d+)\D+$|10.0.1.(($1*2))|&quot;</code></pre>
<h3 id="update-the-mapping-between-the-hostnames-and-the-physical-hardware-components"><a href="#TOC">4.2 Update the mapping between the hostnames and the physical hardware components</a></h3>
<h4 id="use-switch-port-information"><a href="#TOC">4.2.1 Use switch port information</a></h4>
<p>The switch port method uses the switch connection information to determine which hardware component that the hostname is pointing to. The &quot;switch&quot; table needs to be updated to indicate which switch port the FSP/BPA connects to. For example:</p>
<p>Each frame and CEC should have an entry in the &quot;switch&quot; table to indicate which switch port it is connected to. For example:</p>
<pre><code>#node,switch,     port,vlan,interface,comments,disable
bpa  ,10.0.0.254,&quot;|\D+(\d+)\D+$|Gi1/(($1))|&quot;
fsp  ,10,0.0.254,&quot;|\D+(\d+)\D+\d+$|Gi1/(($1))|&quot;</code></pre>
<p>For high end CECs, the &quot;ppc&quot; table also needs to be updated to include the cage id information for each FSP. For low end CECs, the &quot;ppc&quot; table does not need to be updated.</p>
<pre><code>#node,hcp,   id,                         pprofile,parent,supernode,comments,disable
fsp,     ,  &quot;|\D+\d+\D+(\d+)$|(($1))|&quot;</code></pre>
<h4 id="use-vpd-information"><a href="#TOC">4.2.2 Use vpd information</a></h4>
<p>For the high end servers such as POWER 595, only the BPAs MTMS information is necessary, for the low end servers such as POWER 520, the FSPs MTMS information is needed. You have two options to get the MTMS information for all the BPAs or FSPs, you can copy the BPAs or FSPs MTMS information from the front rear of the BPA or CEC manually; or run lsslp to get the basic hardware information from the lsslp output.</p>
<p>Since all the FSPs and BPAs have got ip addresses though the ip addresses are random ones, the lsslp command can be run to get the basic hardware information, but not all the necessary information is available such as the hostname and ip addresses mapping. lsslp has a flag named &quot;--vpdtable&quot; to generate the VPD information into a format that is similar to the vpd table, you can copy and paste all the vpd information from the lsslp output to vpd table.</p>
<p>Run: lsslp -s BPA -z -i 10.0.0.1 --vpdtable &gt; /stanza/file/path</p>
<p>OR</p>
<p>Run: lsslp -s FSP -z -i 10.0.0.1 --vpdtable &gt; /stanza/file/path</p>
<p>The vpd methods uses the MTMS and parent information to determine which hardware component that the hostname is pointing to. For high end servers environment, the &quot;vpd&quot; table needs to be updated to include the BPA MTMS information and the FSP side information, if the systems only have one FSP for each CEC, then the FSP side information is not necessary in vpd table. For the low end servers environment, the &quot;vpd&quot; table needs to be updated to include the FSP MTMS information. All the MTMS information for the BPAs or FSPs can be obtained from the stanza file /stanza/file/path. Here is an example of the stanza file content:</p>
<pre><code>&quot;&quot;,&quot;99200G1&quot;,&quot;9A00-100&quot;,&quot;A&quot;,,,
&quot;&quot;,&quot;99200G1&quot;,&quot;9A00-100&quot;,&quot;B&quot;,,,
    ... ...
&quot;&quot;,&quot;99410D1&quot;,&quot;9A00-100&quot;,&quot;A&quot;,,,
&quot;&quot;,&quot;99410D1&quot;,&quot;9A00-100&quot;,&quot;B&quot;,,,</code></pre>
<p>Copy the stanza file content to the vpd table, add the host names for each item, then the vpd table will look like:</p>
<pre><code>#node,serial,mtm,side,asset,comments,disable
&quot;frame1a&quot;,&quot;99200G1&quot;,&quot;9A00-100&quot;,&quot;A&quot;,,,
&quot;frame1b&quot;,&quot;99200G1&quot;,&quot;9A00-100&quot;,&quot;B&quot;,,,
    ... ...
&quot;frame16a&quot;,&quot;99410D1&quot;,&quot;9A00-100&quot;,&quot;A&quot;,,,
&quot;frame16b&quot;,&quot;99410D1&quot;,&quot;9A00-100&quot;,&quot;B&quot;,,,</code></pre>
<p>Note: The frames MTMS information can be obtained from the stanza file. For low end servers, the FSPs MTMS information can be obtained from the stanza file.</p>
<p>For high end CECs, the &quot;ppc&quot; table also needs to be updated to include the cage id information and the BPA information for each FSP. For low end CECs, the &quot;ppc&quot; table does not need to be updated.</p>
<pre><code>#node,hcp,   id,                         pprofile,parent,supernode,comments,disable
fsp,     ,  &quot;|\D+\d+\D+(\d+)$|(($1))|&quot;,,&quot;|\D+\(d+)\D+\d+$|(frame($1)a)|&quot;,,,</code></pre>
<h2 id="discover-the-hmcs-fsps-and-bpas"><a href="#TOC">5. Discover the HMCs, FSPs and BPAs</a></h2>
<p>The basic logic of lsslp command can be described as:</p>
<ol style="list-style-type: decimal">
<li>Run openslp command to get SLP responses from all the HMCs, BPAs or FSPs.</li>
<li>Parse the SLP responses, generate the nodes attributes based on the SLP responses information and the xCAT tables information described in section &quot;Update xCAT tables&quot;.</li>
<li>If the -w flag is specified, write the node attributes to xCAT database; otherwise, write the node attributes to stdout, stanza file can be used to redirect the output.</li>
<li>If the flag --updatehosts is specified, the ip address information will also be updated into the xCAT database or the stanza file.</li>
<li>If the --makedhcp flag is specified, update DHCP leases file to include the MAC and ip addresses mapping, and internally call makedhcp to setup the DHCP service.</li>
<li>If the --resetnet flag is specified, the rspconfig will login the ASMI and reset the network interfaces on BPAs or FSPs to let the BPAs or FSPs get the new ip addresses from DHCP server</li>
</ol>
<p>The --makedhcp can not be used without -w flag.</p>
<p>Here are several common configuration scenarios, different lsslp flags will be used in the different scenarios, if the random ip address solution is selected, then use the steps in 5.1; if the permanent ip address solution is selected, then use the steps in 5.2.</p>
<h3 id="random-ip-address"><a href="#TOC">5.1 Random ip address</a></h3>
<p>If the random ip address solution is selected, we do not need to run makedhcp or reset network interfaces or BPAs/FSPs, but need to update hosts table. If you want to review stanza file before writting the nodes into xCAT database, then use the steps in 5.1.1; if you want to write the nodes into xCAT database directly, use the steps in 5.1.2.</p>
<h4 id="use-stanza-file"><a href="#TOC">5.1.1 Use stanza file</a></h4>
<ol style="list-style-type: decimal">
<li>lsslp -s HMC -z -i 10.0.0.1 &gt; /hmc/stanza/file</li>
<li>Review the HMC stanza file and make modifications if necessary.</li>
<li>cat /hmc/stanza/file | mkdef -z<br /> </li>
<li>Run lsslp -s BPA -z -i 10.0.0.1 -M {switchport|vpd} --updatehosts &gt; /bpa/stanza/file</li>
<li>Review the BPA stanza file and make modifications if necessary.</li>
<li>cat /bpa/stanza/file | mkdef -z<br /> </li>
<li>Run lsslp -s FSP -z -i 10.0.0.1 -M {switchport|vpd} --updatehosts &gt; /bpa/stanza/file</li>
<li>Review the BPA stanza file and make modifications if necessary.</li>
<li>cat /bpa/stanza/file | mkdef -z</li>
</ol>
<h4 id="update-xcat-database-directly"><a href="#TOC">5.1.2 Update xCAT database directly</a></h4>
<ol style="list-style-type: decimal">
<li>lsslp -s HMC -w -i 10.0.0.1</li>
<li>Run lsslp -s BPA -w -i 10.0.0.1 -M {switchport|vpd} --updatehosts</li>
<li>Run lsslp -s FSP -w -i 10.0.0.1 -M {switchport|vpd} --updatehosts</li>
</ol>
<h3 id="permanent-ip-addresses"><a href="#TOC">5.2 Permanent ip addresses</a></h3>
<p>If the permanent ip address solution is selected, lsslp need to run makedhcp and reset network interfaces or BPAs/FSPs, but does not need to update hosts table. If you want to review stanza file before writting the nodes into xCAT database, then use the steps in 5.2.1; if you want to write the nodes into xCAT database directly, use the steps in 5.2.2.</p>
<h4 id="use-stanza-file-1"><a href="#TOC">5.2.1 Use stanza file</a></h4>
<ol style="list-style-type: decimal">
<li>lsslp -s HMC -z -i 10.0.0.1 &gt; /hmc/stanza/file</li>
<li>Review the HMC stanza file and make modifications if necessary.</li>
<li>cat /hmc/stanza/file | mkdef -z<br /> </li>
<li>lsslp -s BPA -z -i 10.0.0.1 -M {switchport|vpd} &gt; /bpa/stanza/file</li>
<li>Review the BPA stanza file and make modifications if necessary.</li>
<li>cat /bpa/stanza/file | mkdef -z<br /> </li>
<li>lsslp -s FSP -z -i 10.0.0.1 -M {switchport|vpd} &gt; /bpa/stanza/file</li>
<li>Review the BPA stanza file and make modifications if necessary.</li>
<li>cat /bpa/stanza/file | mkdef -z<br /> </li>
<li>makedhcp -a</li>
<li>rspconfig frame --resetnet</li>
<li>rspconfig cec --resetnet</li>
</ol>
<p>Note: the rspconfig --resetnet does not need to rerun the slp client to perform discovery, it simply uses the ip addresses information in the &quot;ip&quot; attribute or &quot;otherinterfaces&quot; attribute in the hosts table to login the ASMI and do the network interface reset. Since the &quot;otherinterfaces&quot; attribute is used to temporarily store the random ip addresses information, so the rspconfig --resetnet will remove the &quot;otherinterfaces&quot; items from hosts table.</p>
<h4 id="update-xcat-database-directly-1"><a href="#TOC">5.2.2 Update xCAT database directly</a></h4>
<ol style="list-style-type: decimal">
<li>lsslp -s HMC -w -i 10.0.0.1</li>
<li>lsslp -s BPA -w -i 10.0.0.1 -M {switchport|vpd} --makedhcp</li>
<li>lsslp -s FSP -z -i 10.0.0.1 -M {switchport|vpd} --makedhcp</li>
</ol>
<h2 id="connect-fsps-and-bpas-to-hmc"><a href="#TOC">6. Connect FSPS and BPAs to HMC</a></h2>
<p>There are two ways to specify the HMC for each FSP and BPA, use the xCAT table or through the mkhwconn -p flag, either way can be used.</p>
<p>Here is an example of the xCAT table method:</p>
<pre><code>ppc table:
#node,hcp,   id,                         pprofile,parent,supernode,comments,disable
bpa,  &quot;|\D+(\d+)\D+$|hmc(($1/8))|&quot; 
fsp,  &quot;|\D+(\d+)\D+\d+$|hmc($1/8)|&quot; </code></pre>
<p>Run mkhwconn bpa -t</p>
<p>Run mkhwconn fsp -t</p>
<h2 id="set-initial-password-for-fspbpa-if-they-are-brand-new-machines"><a href="#TOC">7. Set initial password for FSP/BPA if they are brand new machines</a></h2>
<pre><code>rspconfig bpa HMC_passwd=abc123
rspconfig bpa general_passwd=abc123
rspconfig bpa admin_passwd=abc123
rspconfig fsp HMC_passwd=abc123
rspconfig fsp general_passwd=abc123
rspconfig fsp admin_passwd=abc123</code></pre>
<h2 id="run-rspconfig-to-setup-the-frame-numbers"><a href="#TOC">8. Run rspconfig to setup the frame numbers</a></h2>
<p>To setup the frame numbers, the frame numbers information should first be added to ppc table:</p>
<pre><code>ppc table:
#node,hcp,   id,                         pprofile,parent,supernode,comments,disable
bpa,  &quot;|\D+(\d+)\D+$|hmc(($1/8))|&quot;, &quot;|\D+(\d+)\D+$|(($1))|&quot;



rspconfig bpa frame=*</code></pre>
<h2 id="run-rspconfig-to-setup-hostnames-on-the-fsps-and-bpas"><a href="#TOC">9. Run rspconfig to setup hostnames on the FSPs and BPAs</a></h2>
<p>All the FSPs and BPAs hostnames mentioned above are only used in the xCAT database, the rspconfig command can be used to setup the hostnames on the FSPs and BPAs,</p>
<pre><code>rspconfig fsp hostname=*
rspconfig bpa hostname=*</code></pre>
<h2 id="others"><a href="#TOC">10. Others</a></h2>
<ul>
<li>enable dev/celogin on FSP/BPA if needed</li>
<li>remove service parition if needed</li>
<li>create full partition if needed</li>
</ul>
</body>
</html>
