<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
</head>
<body>
<div id="TOC">
<ul>
<li><a href="#pre-install">Pre-install</a><ul>
<li><a href="#network-wiring">Network wiring</a></li>
</ul></li>
<li><a href="#install-the-operating-system">Install the operating system</a></li>
<li><a href="#install-xcat">Install xCAT</a></li>
<li><a href="#setup-networking">Setup Networking</a></li>
<li><a href="#setup-the-xcat-tables">Setup the xCAT tables</a></li>
<li><a href="#advanced-features">Advanced features</a></li>
</ul>
</div>
<p><!-- START doctoc generated TOC please keep comment here to allow auto update --> <!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --> Table of Contents</p>
<ul>
<li><a href="#pre-install">Pre-install</a></li>
<li><a href="#network-wiring">Network wiring</a></li>
<li><a href="#install-the-operating-system">Install the operating system</a></li>
<li><a href="#install-xcat">Install xCAT</a></li>
<li><a href="#setup-networking">Setup Networking</a></li>
<li><a href="#setup-the-xcat-tables">Setup the xCAT tables</a></li>
<li><a href="#advanced-features">Advanced features</a></li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->

<p><a href="Howto_Warning">Howto_Warning</a></p>
<p>Directions for setting up xCAT on a Fedora 10 server, and enabling it to use kvm.</p>
<h2 id="pre-install"><a href="#TOC">Pre-install</a></h2>
<p>Before installing, these decisions need to be made:</p>
<ul>
<li>Internal IP of headnode - referred to as (xcat_int_ip)</li>
<li>External IP (internet connected) of headnode - referred to as (xcat_ext_ip)</li>
<li>External DNS server IP - referred to as (dns_ext_ip)</li>
<li>Cluster domain - referred to as (cluster_dom)</li>
</ul>
<h3 id="network-wiring"><a href="#TOC">Network wiring</a></h3>
<p>This setup assumes your xCAT node has eth0 plugged into an existing network, connected to the internet and using DHCP. Eth1 is attached to the switch that the compute nodes are attached to.</p>
<h2 id="install-the-operating-system"><a href="#TOC">Install the operating system</a></h2>
<p>A basic Desktop install will do fine. Turn off the Firewall and SELinux to be able to access the node from your network (most xCAT servers are already behind a company firewall). Install all updates.</p>
<h2 id="install-xcat"><a href="#TOC">Install xCAT</a></h2>
<p>Add the xCAT package repositories<br />Note: These are for the latest snapshot release which include all the necessary features. It is expected that full support for these features will be in the xCAT 2.2 stable release. See the <a href="http://xcat.sourceforge.net/yum/download.html">Download</a> page for more info.</p>
<p>There is not yet a Fedora 10 repository, so we will use the redhat 5 repositroy. There is one dependancy that it does not fulfill, so it must be manually installed first:</p>
<pre><code>wget http://xcat.sourceforge.net/yum/xcat-dep/fedora9/x86_64/conserver-8.1.16-8.x86_64.rpm
rpm -i conserver-8.1.16-8.x86_64.rpm
cd /etc/yum.repos.d
wget http://xcat.sourceforge.net/yum/devel/core-snap/xCAT-core-snap.repo
wget http://xcat.sourceforge.net/yum/xcat-dep/rh5/x86_64/xCAT-dep.repo
yum clean metadata
yum install xCAT</code></pre>
<p>Verify the install</p>
<pre><code>source /etc/profile.d/xcat.sh
tabdump site</code></pre>
<p>If the tabdump command works, xCAT is installed.</p>
<h2 id="setup-networking"><a href="#TOC">Setup Networking</a></h2>
<p>Configure the Ethernet interfaces</p>
<pre><code>vi /etc/sysconfig/network-scripts/ifcfg-eth0

DEVICE=eth0
PEERDNS=no
BOOTPROTO=dhcp
HWADDR=00:14:5E:6B:18:21
ONBOOT=yes

ifdown eth0 &amp;&amp; ifup eth0

vi /etc/sysconfig/network-scripts/ifcfg-eth1

DEVICE=eth1
BOOTPROTO=static
HWADDR=00:14:5E:6B:18:22
ONBOOT=yes
IPADDR=(xcat_int_ip)
NETMASK=255.255.255.0

ifdown eth1 &amp;&amp; ifup eth1</code></pre>
<p>Configure the site table.<br />This will set the dns to forward requests for the 192.168.0.1 network, set the domain to cluster, set the master and nameserver to 192.168.0.1, and set eth1 to be the dhcp interface.</p>
<pre><code>tabedit site

#key,value,comments,disable
&quot;xcatdport&quot;,&quot;3001&quot;,,
&quot;xcatiport&quot;,&quot;3002&quot;,,
&quot;tftpdir&quot;,&quot;/tftpboot&quot;,,
&quot;master&quot;,&quot;10.10.10.100&quot;,,
&quot;domain&quot;,&quot;cluster&quot;,,
&quot;installdir&quot;,&quot;/install&quot;,,
&quot;timezone&quot;,&quot;America/Denver&quot;,,
&quot;nameservers&quot;,&quot;192.168.0.1&quot;,,
&quot;forwarders&quot;,&quot;192.168.0.1&quot;
&quot;dhcpinterfaces&quot;,&quot;eth1&quot;
&quot;ntpservers&quot;,&quot;0.north-america.pool.ntp.org&quot;</code></pre>
<p>Add the xCAT node and compute nodes to the hosts file</p>
<pre><code>vi /etc/hosts
10.10.10.1 xcat
10.10.10.101 n01
10.10.10
...</code></pre>
<p>Setup the mac table</p>
<pre><code>n01,eth0,00:11:22:33:44:55:66
n02,eth0,00:11:22:33:44:55:67
...</code></pre>
<p>Setup the networks table</p>
<pre><code>tabedit networks</code></pre>
<p>There should be an entry for each network the nodes need to access. In this case, DNS is forwarded to the 192.168.0.1 server:</p>
<pre><code>tabedit networks
#netname,net,mask,mgtifname,gateway,dhcpserver,tftpserver,nameservers,dynamicrange,nodehostname,comments,disable
,&quot;10.10.10.0&quot;,&quot;255.255.255.0&quot;,&quot;eth1&quot;,&quot;10.10.10.1&quot;,&quot;10.10.10.1&quot;,&quot;10.10.10.1&quot;,&quot;192.168.0.1&quot;,&quot;10.10.10.200-10.10.10.250&quot;,,,
,&quot;192.168.0.0&quot;,&quot;255.255.0.0&quot;,&quot;eth0&quot;,,,,&quot;192.168.0.1&quot;,,,,</code></pre>
<p>Build the DHCP file</p>
<pre><code>makedhcp -n
service dhcpd restart</code></pre>
<p>Setup DNS<br />Be sure to remove bind-chroot if you're using a centos 5.2 install<br />(or any other system that uses it for that matter!)<br />xCat doesn't work with bind-chroot, just the regular bind!</p>
<pre><code>yum remove bind-chroot</code></pre>
<p>Edit resolv.conf</p>
<pre><code>vi /etc/resolv.conf
set &quot;search cluster&quot;
set &quot;nameserver 10.10.10.1&quot;</code></pre>
<p>Build the DNS server</p>
<pre><code>makedns
service named start</code></pre>
<h2 id="setup-the-xcat-tables"><a href="#TOC">Setup the xCAT tables</a></h2>
<p>The Site table - this table defines your xCAT environment</p>
<p>Setup the nodelist table</p>
<pre><code>tabedit nodelist
&quot;n01&quot;,&quot;compute,all&quot;,,,
&quot;n01-ipmi&quot;,&quot;ipmi,all&quot;,,,
&quot;n02&quot;,&quot;compute,all&quot;,,,
...</code></pre>
<p>Setup the nodehm table</p>
<pre><code>tabedit nodehm
&quot;n01&quot;,&quot;ipmi&quot;,&quot;ipmi&quot;,,,,,,,,,,
&quot;n02&quot;,&quot;ipmi&quot;,&quot;ipmi&quot;,,,,,,,,,,
...</code></pre>
<p>Setup the noderes,passwd,chain and nodetype tables</p>
<pre><code>chtab node=compute noderes.netboot=pxe noderes.tftpserver=10.10.10.100 noderes.nfsserver=10.10.10.100 noderes.installnic=eth0 noderes.primarynic=eth0
chtab key=system passwd.username=root passwd.password=cluster
chtab node=compute nodetype.os=centos5.2 nodetype.arch=x86_64 nodetype.profile=compute nodetype.nodetype=osi
chtab node=compute chain.chain=&quot;runcmd=standby&quot; chain.ondiscover=nodediscover</code></pre>
<p>Setup Images -do this for the DVD and ISO and '''NOT''' the cd!</p>
<pre><code>copycds CentOS-5.2-i386-bin-DVD.iso</code></pre>
<p>Create the PXE boot files</p>
<pre><code>mknb x86_64</code></pre>
<p>Install the node!</p>
<pre><code>rinstall n01</code></pre>
<h2 id="advanced-features"><a href="#TOC">Advanced features</a></h2>
<p>To create a netboot image:<br />cd /opt/xcat/share/xcat/netboot/centos<br />./genimage -i eth0 -n e1000,bnx2 -o centos5.2 -p compute<br />cd /install/netboot/centos5.2/x86_64/compute/rootimg/etc/<br />cp fstab fstab.ORIG<br />vi fstab</p>
<pre><code>add these lines:</code></pre>
<p>compute_x86_64 / tmpfs rw 0 1<br />none /tmp tmpfs defaults,size=10m 0 2<br />none /var/tmp tmpfs defaults,size=10m 0 2</p>
<pre><code>wq  </code></pre>
<p>packimage -o centos5.2 -p compute -a x86_64<br />nodeset (nodename) netboot<br />rpower (nodename) boot</p>
</body>
</html>
