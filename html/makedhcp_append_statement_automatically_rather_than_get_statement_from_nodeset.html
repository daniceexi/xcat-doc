<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
</head>
<body>
<div id="TOC">
<ul>
<li><a href="#background">Background</a></li>
<li><a href="#overview">Overview</a></li>
<li><a href="#design-details">Design details</a></li>
<li><a href="#other-design-considerations">Other Design Considerations</a></li>
</ul>
</div>
<p><!-- START doctoc generated TOC please keep comment here to allow auto update --> <!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --> Table of Contents</p>
<ul>
<li><a href="#background">Background</a></li>
<li><a href="#overview">Overview</a></li>
<li><a href="#design-details">Design details</a></li>
<li><a href="#other-design-considerations">Other Design Considerations</a></li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->

<p><a href="Design_Warning">Design_Warning</a></p>
<h2 id="background"><a href="#TOC">Background</a></h2>
<p>The command 'makedhcp -a' or 'makedhcp node' can be used to define nodes into DHCP server. It will be run when installing xCAT, or manually by system admin.  There are 4 modules that will call &quot;makedhcp -s <statement>&quot; within &quot;nodeset&quot; to write <statement> into dhcp lease file.  The issue is, if run &quot;makedhcp -a&quot; or &quot;makedhcp node&quot; after &quot;nodeset&quot; , the useful <statement> info will be deleted. Pls reference https://sourceforge.net/p/xcat/bugs/4622/ for more information. </p>
<h2 id="overview"><a href="#TOC">Overview</a></h2>
<p>In order to resolve the issue mentioned above, the idea is to write <statement> in &quot;makedhcp -a&quot; or &quot;makedhcp node&quot; (in addnode subroutine in fact) based on node netboot attribute.</p>
<h2 id="design-details"><a href="#TOC">Design details</a></h2>
<p>The modules and the <statement> that they write into dhcp lease file are as belows:</p>
<ul>
<li>petitboot.pm The statement: option conf-file &quot;http://<span class="math"><em>m</em><em>n</em><sub><em>i</em></sub><em>p</em> / <em>t</em><em>f</em><em>t</em><em>p</em><em>b</em><em>o</em><em>o</em><em>t</em> / <em>p</em><em>e</em><em>t</em><em>i</em><em>t</em><em>b</em><em>o</em><em>o</em><em>t</em> / </span>node&quot;;</li>
</ul>
<p>* nimol.pm The statement: supersede server.filename = &quot;/<span class="math"><em>v</em><em>i</em><em>o</em><em>s</em> − <em>d</em><em>i</em><em>s</em><em>t</em><em>r</em><em>o</em><em>n</em><em>a</em><em>m</em><em>e</em> / <em>n</em><em>o</em><em>d</em><em>e</em><em>s</em> / <em>v</em><em>i</em><em>o</em><em>b</em><em>o</em><em>o</em><em>t</em><em>i</em><em>m</em><em>g</em> − </span>nodename&quot;;</p>
<ul>
<li>grub2.pm
<ul>
<li>The statement when doing os provisioning: filename=&quot;/boot/grub2/grub2.ppc&quot;;   * The statement after reboot: filename = &quot;xcat/nonexistant_file_to_intentionally_break_netboot_for_localboot_to_work&quot;;</li>
</ul></li>
<li>yaboot.pm   * The statement when doing os provisioning: filename=&quot;/yb/$osvers/yaboot&quot;;   * The statement after reboot: filename = &quot;xcat/nonexistant_file_to_intentionally_break_netboot_for_localboot_to_work&quot;;</li>
</ul>
<p>In order to provide a easy fix, the following will be done:</p>
<ul>
<li><p>For nimol.pm   * the statement filename will be &quot;/vios/nodes/<span class="math">$node&quot;   * when 'nodeset', link /tftpboot/vios/nodes/$</span>node to the specified vios-bootimage-file</p></li>
<li><p>For yaboot.pm   * the statement filename will be &quot;/yb/node/yaboot-<span class="math">$nodename&quot;   * when 'nodeset', link /tftpboot/yb/$</span>osvers/yaboot to the specified statement file.   * when 'updateflag', remove /tftpboot/yb/node/yaboot-$nodename</p></li>
<li><p>For grub2.pm   * the statement filename will be &quot;/boot/grub2/grub2-<span class="math">$nodename.ppc&quot;   * when 'nodeset', link /tftpboot/boot/grub2/grub2.ppc to the specified statement file.   * when 'updateflag', remove /tftpboot/boot/grub2/grub2-$</span>nodename.ppc</p></li>
<li><p>For petitboot.pm   * write the statement filename &quot;http://<span class="math"><em>m</em><em>n</em><sub><em>i</em></sub><em>p</em> / <em>t</em><em>f</em><em>t</em><em>p</em><em>b</em><em>o</em><em>o</em><em>t</em> / <em>p</em><em>e</em><em>t</em><em>i</em><em>t</em><em>b</em><em>o</em><em>o</em><em>t</em> / </span>node&quot;</p></li>
</ul>
<p>With the fix above, run &quot;makedhcp -a&quot; or &quot;makedhcp node&quot; before &quot;nodeset&quot;, &quot;nodeset&quot; won't need to call 'makedhcp' internally anymore.</p>
<h2 id="other-design-considerations"><a href="#TOC">Other Design Considerations</a></h2>
<ul>
<li><strong>Required reviewers</strong>:</li>
<li><strong>Required approvers</strong>: Guang Cheng</li>
<li><strong>Database schema changes</strong>: N/A</li>
<li><strong>Affect on other components</strong>: N/A</li>
<li><strong>External interface changes, documentation, and usability issues</strong>: N/A</li>
<li><strong>Packaging, installation, dependencies</strong>: N/A</li>
<li><strong>Portability and platforms (HW/SW) supported</strong>: N/A</li>
<li><strong>Performance and scaling considerations</strong>: N/A</li>
<li><strong>Migration and coexistence</strong>: N/A</li>
<li><strong>Serviceability</strong>: N/A</li>
<li><strong>Security</strong>: N/A</li>
<li><strong>NLS and accessibility</strong>: N/A</li>
<li><strong>Invention protection</strong>: N/A</li>
</ul>
</body>
</html>
