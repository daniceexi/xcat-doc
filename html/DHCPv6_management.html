<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
</head>
<body>
<p>{{:Design Warning}}</p>
<p>In DHCPv6, the identifier shifts from MAC address of the specific interface to a system wide DUID. Given the goal of trying to preserve current general behavior, xCAT will have to examine and modify supported install images to generate a consistent DUID that spans installations. Depending on mechanism, it may also be required that xCAT modify stateful installed image to re-source DUID from a secondary source on every boot prior to network bringup to avoid DUID cloning. Four options are possible:</p>
<ul>
<li>Use IPv4 to bootstrap and have xCAT hand down arbitrary DUIDs managed centrally</li>
<li>Use DUID-LL to generate the same DUID regardless of time and refresh DUID contents on every boot (may be considered a violation of RFC3315 with regards to behavior on NIC change)</li>
<li>Use DUID-EN to derive an identifier out of some enterprise number and the UUID. This may be workable for OS installs, but not likely to match netboot firmware. Note we'd have to not use the vendor number of the provider of the equipment, as that would be a violation of the RFC unless that vendor has signed off on it explicitly.</li>
<li>Get a new DUID method adopted in the industry (preferred option, http://tools.ietf.org/html/draft-narten-dhc-duid-uuid-01 in progress)
<ul>
<li>DUID-UUID an optimal solution, where the DUID contents is simply a well-known type number (i.e. 4) plus UUID</li>
<li>UUID validity assurance required for replacement parts (cross-vendor implementation a challenge).</li>
<li>If UUID invalid, fallback to DUID-LLT</li>
<li>If DUID-LLT, boot discovery image, discovery image gets system discovered and on a system without existing UUID in xCAT, generate a new one, if replacement detected, restore old UUID</li>
</ul></li>
</ul>
<p>For each existing platform, must pre-populate DUID prior to network bringup.</p>
<p>For dhcp6c systems (RHEL5, SLES11, and similar vintage):</p>
<ul>
<li>Update /var/lib/dhcpv6/dhcp6c_duid
<ul>
<li>Binary file, first two bytes DUID length followed by DUID in binary representation</li>
<li>POWER/x86 Endian difference matters, bytes in file are host-order, not network-order</li>
<li>xxd Can be used to create dhcp6c_duid</li>
<li>RHEL5, little hope for provisioning time DUID type switch before it gets stage2, initrd too monolithic</li>
<li>Unfortunately, it only works once. dhcp6c successfully reads and uses the DUID, but on exit corrupts the DUID by trancating it.</li>
</ul></li>
</ul>
<p>For Windows Vista/2k8 and newer:</p>
<ul>
<li>Modify HKEY_LOCAL_MACHINE66DUID
<ul>
<li>Already checked into 2.5 using wmic to get the UUID</li>
</ul></li>
</ul>
<p>For ISC DHCP 4+ clients (i.e. RHEL6, ESXi4.1):</p>
<ul>
<li><p>Modify dhclient6.leases to have a 'defualt-duid' setting amenable to our needs. For example, if a system had UUID c4b72aec-bdd3-42a3-8d47-76b79a8a9c95:</p>
<p>default-duid &quot;00040467*547523B4315Gv6732123425&quot;;</p></li>
<li><p>Rough perl code to convert hex UUID to this string format:</p>
<p>$uuid =~ s/-//g; $uuid =~ s/://g; <span class="math">$uuid =~ s/(..)/\1:/g; my @uuid = split /:/,$</span>uuid; foreach (@uuid) { <span class="math">$_ = hex($</span><em>); if ($</em></p></li>
<li><p>More useful shell code to extract and convert UUID that could be executed from the stock RHEL6 install initrd:</p>
<p>duid='default-duid &quot;0004'; for i in <code>sed -e s/-//g -e 's/\(..\)/\1 /g' /sys/devices/virtual/dmi/id/product_uuid</code>; do num=<code>printf &quot;%d&quot; 0x$i</code> octnum=<code>printf &quot;\\%03o&quot; 0x$i</code> if [ $num -lt 127 -a $num -gt 31 ]; then octnum=<code>printf $octnum</code> fi duid=<span class="math"><em>d</em><em>u</em><em>i</em><em>d</em></span>octnum done duid=$duid'&quot;;' echo $duid &gt; &lt;leasefilehere&gt;</p></li>
<li>Extracting UUID:
<ul>
<li>Linux systems use dmidecode</li>
<li>Windows systems use wmic csproduct</li>
<li>xCAT has an implementation checked into 2.5 (pending finalizing the DUID type number)</li>
<li>ESXi uses vsish -e get /hardware/machineUUID</li>
<li>xCAT has an implementation checked in for ESXi stateless 4.1 (pending finalizing the DUID type number)</li>
<li>RHEL6 /sys/devices/virtual/dmi/id/product_uuid</li>
</ul></li>
</ul>
</body>
</html>
