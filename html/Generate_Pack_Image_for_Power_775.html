<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
</head>
<body>
<div id="TOC">
<ul>
<li><a href="#configure-postinstall-files-for-power-775-optional">Configure postinstall files for Power 775 (Optional)</a></li>
<li><a href="#generatepack-your-image-for-power-775">Generate/Pack your image for Power 775</a></li>
</ul>
</div>
<p><!-- START doctoc generated TOC please keep comment here to allow auto update --> <!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --> Table of Contents</p>
<ul>
<li><a href="#configure-postinstall-files-for-power-775-optional">Configure postinstall files for Power 775 (Optional)</a></li>
<li><a href="#generatepack-your-image-for-power-775">Generate/Pack your image for Power 775</a></li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->

<h5 id="configure-postinstall-files-for-power-775-optional"><a href="#TOC">Configure postinstall files for Power 775 (Optional)</a></h5>
<p>IF not using Power 775 hardware, skip this section. **** The HFI kernel can be installed by xCAT automatically. Other packages, such as hfi_util and nettools, require the rpm options --nodeps or --force respectively, which xCAT cannot handle automatically. We need to modify the postinstall file to install those packages during the diskless image generation.</p>
<p>Add the following lines to /install/test/netboot/rh/hfi.postinstall. (You can use any name you desire for the file, this is an example.</p>
<pre><code>    
    cp /hfi/dd/* /install/test/netboot/rh/ppc64/compute/rootimg/tmp/
    chroot /install/test/netboot/rh/ppc64/compute/rootimg/ /bin/rpm -ivh &#39;/tmp/dhclient-*.rpm&#39; --force
    chroot /install/test/netboot/rh/ppc64/compute/rootimg/ /bin/rpm -ivh &#39;/tmp/dhcp-*.rpm&#39; --force
    chroot /install/test/netboot/rh/ppc64/compute/rootimg/ /bin/rpm -ivh &#39;/tmp/kernel-headers-*.rpm&#39; --force
    chroot /install/test/netboot/rh/ppc64/compute/rootimg/ /bin/rpm -ivh &#39;/tmp/net-tools-*.rpm&#39; --force
    chroot /install/test/netboot/rh/ppc64/compute/rootimg/ /bin/rpm -ivh &#39;/tmp/hfi_ndai-*.rpm&#39; --force
    chroot /install/test/netboot/rh/ppc64/compute/rootimg/ /bin/rpm -ivh &#39;/tmp/hfi_util-*.rpm&#39; --force
</code></pre>
<p>Now update the image definition with the postinstall file location:</p>
<pre><code>    chdef -o osimage -t redhat6img postinstall=/install/test/netboot/rh/hfi.postinstall</code></pre>
<h5 id="generatepack-your-image-for-power-775"><a href="#TOC">Generate/Pack your image for Power 775</a></h5>
<p>If not using Power 775 hardware, skip this section. In Power 775, there is a HFI enabled kernel required in the diskless image. The compute nodes could boot from this customized kernel and boot from HFI interfaces.</p>
<pre><code>    chdef -t osimage -o redhat6img kerneldir=/install/kernels
    cp /hfi/dd/kernel-2.6.32-71.el6.20110617.ppc64.rpm /install/kernels/
    genimage -i hf0 -n hf_if  -k 2.6.32-71.el6.20110617.ppc64 redhat6img</code></pre>
<p>Sync /etc/hosts to the diskless image for Power 775</p>
<p>This is used by the postscript hficonfig to configure all the HFI interfaces on the compute nodes. Setup a synclist file containing this line:</p>
<pre><code>    
    /etc/hosts -&gt; /etc/hosts</code></pre>
<p>The file can be put anywhere, but let's assume you name it /tmp/synchosts.</p>
<p>Make sure you have an OS image object in the xCAT database associated with your nodes and issue command:</p>
<pre><code>    xdcp -i &lt;imagepath&gt; -F /tmp/synchosts</code></pre>
<p>&lt;imagepath&gt; stands for the OS image path. This is the directory we defined when we setup our image. To find the path run:</p>
<pre><code>    lsdef -t image -o redhat6img | grep rootimgdir
      /install/netboot/rhels6/ppc64/compute</code></pre>
<p>Then run the following command:</p>
<pre><code>    xdcp -i /install/netboot/rhels6/ppc64/compute/rootimg -F /tmp/synchosts</code></pre>
<p>Now pack the image:</p>
<pre><code>    packimage redhat6img</code></pre>
</body>
</html>
