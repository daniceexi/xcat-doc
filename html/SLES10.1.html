<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
</head>
<body>
<div id="TOC">
<ul>
<li><a href="#step-1">Step 1</a></li>
<li><a href="#step-2">Step 2</a></li>
<li><a href="#step-3">Step 3</a></li>
<li><a href="#step-4">Step 4</a></li>
<li><a href="#step-5">Step 5</a></li>
<li><a href="#stateless">Stateless</a></li>
</ul>
</div>
<p><!-- START doctoc generated TOC please keep comment here to allow auto update --> <!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --> Table of Contents</p>
<ul>
<li><a href="#step-1">Step 1</a></li>
<li><a href="#step-2">Step 2</a></li>
<li><a href="#step-3">Step 3</a></li>
<li><a href="#step-4">Step 4</a></li>
<li><a href="#step-5">Step 5</a></li>
<li><a href="#stateless">Stateless</a></li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->

<p><a href="Howto_Warning">Howto_Warning</a></p>
<p><strong>Note: Refer to [XCAT_iDataPlex_Cluster_Quick_Start] for a more up to date quick start guide.</strong></p>
<h2 id="step-1"><a href="#TOC">Step 1</a></h2>
<p>Install base OS, nothing special except:</p>
<ul>
<li>Turn off firewall unless you want to go through the hassle of configuring it. (Most of our sites are well protected already)</li>
<li>Make a directory called /install/packages to install everything</li>
<li>Copy the SLES 10 SP1 iso image to /install/packages</li>
</ul>
<h2 id="step-2"><a href="#TOC">Step 2</a></h2>
<ul>
<li>Setup /etc/hosts</li>
<li>Use YaST to update your SLES10 SP1 repository. Zypper doesn't work in adding iso images. Use the iso image you copied in /install/packages</li>
<li>vi /etc/sysconfig/network/ifcfg-eth&lt;mac address&gt; the way you want
<ul>
<li>TIP: To change the order of your ethernet interfaces change /etc/udev/30_persistant_names ... (or something like that, I'm doing this from memory...</li>
</ul></li>
</ul>
<h2 id="step-3"><a href="#TOC">Step 3</a></h2>
<pre><code>mkdir /install/packages/xcat
cp &amp;lt;wherever you downloaded xCAT to&amp;gt;/xcat-*bz /install/packages/xcat</code></pre>
<p>Untar</p>
<pre><code>tar jxf xcat-core*bz; tar jxf xcat-dep*.bz</code></pre>
<p>Use Zypper to set up your repository</p>
<pre><code>zypper sa file:///install/packages/xcat/xcat-core
zypper sa file:///install/packages/xcat/xcat-dep/sles10/x86_64</code></pre>
<p>Install xCAT</p>
<pre><code>zypper in xCAT</code></pre>
<h2 id="step-4"><a href="#TOC">Step 4</a></h2>
<p>Set up environment and services</p>
<pre><code>. /etc/profile.d/xcat.sh
tabdump site # just to check to make sure it works
chkconfig –add nfsserver; service nfsserver restart
chkconfig –add ntp; service ntp restart
# correct this xCAT BUG
cp /etc/httpd/conf.d/xcat.sh /etc/apache2/conf.d/
chkconfig –add apache2; service apache2 restart
chkconfig –add tftpd; service tftpd restart</code></pre>
<h2 id="step-5"><a href="#TOC">Step 5</a></h2>
<p>Setup tables as documented and copycds... no changes here, just make sure nodetype is set to sles10.1 as the OS.</p>
<h2 id="stateless"><a href="#TOC">Stateless</a></h2>
<p>If you are deploying a stateless image, genimage in /opt/xcat/share/xcat/netboot/sles does not work because zypper is buggy. (Its fixed in SP2)</p>
<p>To install stateless you need to install YUM from the SDK DVD that comes with SLES10.1 as well as createrepo and all the dependencies.</p>
<p>Once you have it do:</p>
<pre><code>cd /install/sles10.1/x86_64
createrepo .</code></pre>
<p>Note: You need to do it in /install/sles10.1/x86_64 instead of /install/sles10.1/x86_64/1 otherwise it will ruin your YAST diskful installs.<br />Once done you need to use genimage.yum to make this work. Copy the code below into /opt/xcat/share/xcat/netboot/sles/genimage.yum</p>
<p>Note: You need to do it in /install/sles10.1/x86_64 instead of /install/sles10.1/x86_64/1 otherwise it will ruin your YAST diskful installs.</p>
<p>Once done you need to use genimage.yum to make this work. Copy the code below into /opt/xcat/share/xcat/netboot/sles/genimage.yum</p>
<pre><code>#!/usr/bin/env perl
use Data::Dumper;
use File::Basename;
use File::Path;
use File::Copy;
use File::Find;
use Getopt::Long;
#use strict;
Getopt::Long::Configure(&quot;bundling&quot;);
Getopt::Long::Configure(&quot;pass_through&quot;);

my $prinic; #TODO be flexible on node primary nic
my $othernics; #TODO be flexible on node primary nic
my $netdriver;
my @yumdirs;
my $arch = `uname -m`;
chomp($arch);
if ($arch =~ /i.86$/) {
$arch = x86;
}
my %libhash;
my @filestoadd;
my $profile;
my $osver;
my $pathtofiles=dirname($0);
my $name = basename($0);
my $onlyinitrd=0;
if ($name =~ /geninitrd/) {
$onlyinitrd=1;
}
my $rootlimit;
my $tmplimit;
my $installroot = &quot;/install&quot;;
my $kernelver = &quot;&quot;; #`uname -r`;
my $basekernelver; # = $kernelver;

sub xdie {
system(&quot;rm -rf /tmp/xcatinitrd.$$&quot;);
die @_;
}

$SIG{INT} = $SIG{TERM} = sub { xdie &quot;Interrupted&quot; };
GetOptions(
&#39;a=s&#39; =&amp;gt; \$arch,
&#39;p=s&#39; =&amp;gt; \$profile,
&#39;o=s&#39; =&amp;gt; \$osver,
&#39;n=s&#39; =&amp;gt; \$netdriver,
&#39;i=s&#39; =&amp;gt; \$prinic,
&#39;r=s&#39; =&amp;gt; \$othernics,
&#39;l=s&#39; =&amp;gt; \$rootlimit,
&#39;t=s&#39; =&amp;gt; \$tmplimit,
&#39;k=s&#39; =&amp;gt; \$kernelver
);
#Default to the first kernel found in the install image if nothing specified explicitly.
#A more accurate guess than whatever the image build server happens to be running
#If specified, that takes precedence.
#if image has one, that is used
#if all else fails, resort to uname -r like this script did before
my @KVERS= &amp;lt;nodebootif&amp;gt; -n &amp;lt;nodenetdrivers&amp;gt; [-r &amp;lt;otherifaces&amp;gt;] -o &amp;lt;OSVER&amp;gt; -p &amp;lt;PROFILE&amp;gt; -k &amp;lt;KERNELVER&amp;gt;&#39;.&quot;\n&quot;;
print &quot;Examples:\n&quot;;
print &quot; genimage -i eth0 -n tg3 -o centos5.1 -p compute\n&quot;;
print &quot; genimage -i eth0 -r eth1,eth2 -n tg3,bnx2 -o centos5.1 -p compute\n&quot;;
exit 1;
}
my @ndrivers;
foreach (split /,/,$netdriver) {
unless (/\.ko$/) {
s/$/.ko/;
}
if (/^$/) {
next;
}
push @ndrivers,$_;
}
unless (grep /af_packet/,@ndrivers) {
unshift(@ndrivers,&quot;af_packet.ko&quot;);
}

unless ($onlyinitrd) {
my $srcdir = &quot;$installroot/$osver/$arch/&quot;;
find(\&amp;isyumdir, &amp;lt;EOMS;
echo &quot;You&#39;re dead.  rpower nodename reset to play again.

* Did you packimage with -m cpio, -m squashfs, or -m nfs?
* If using -m squashfs did you include aufs.ko with geninitrd?
e.g.:  -n tg3,squashfs,aufs,loop
* If using -m nfs did you export NFS and sync rootimg?  And
did you include the aufs and nfs modules in the proper order:
e.g.:  -n tg3,aufs,loop,sunrpc,lockd,nfs_acl,nfs

&quot;
sleep 5
EOMS
print $inifile &quot;  exit\n&quot;;
print $inifile &quot;fi\n&quot;;
print $inifile &quot;cd /\n&quot;;
print $inifile &quot;cp /var/lib/dhcpcd/* /sysroot/var/lib/dhcpcd/\n&quot;;
print $inifile &quot;cp /etc/resolv.conf /sysroot/etc/\n&quot;;
print $inifile &quot;cp /etc/HOSTNAME /sysroot/etc/\n&quot;;
print $inifile &quot;mknod /sysroot/dev/console c 5 1\n&quot;;
print $inifile &quot;exec /lib/mkinitrd/bin/run-init -c /dev/console /sysroot /sbin/init\n&quot;;
close($inifile);
open($inifile,&quot;&amp;gt;&quot;.&quot;/tmp/xcatinitrd.$$/bin/netstart&quot;);
print $inifile &quot;#!/bin/bash\n&quot;;
print $inifile &quot;dhcpcd $prinic\n&quot;;
print $inifile &quot;echo -n &#39;search &#39;&amp;gt; /etc/resolv.conf\n&quot;;
print $inifile &quot;grep DOMAIN /var/lib/dhcpcd/*info|awk -F= &#39;{print \$2}&#39;|awk -F\\&#39; &#39;{print \$2}&#39; &amp;gt;&amp;gt; /etc/resolv.conf\n&quot;;
print $inifile &quot;grep HOSTNAME /var/lib/dhcpcd/*info|awk -F= &#39;{print \$2}&#39;|awk -F\\&#39; &#39;{print \$2}&#39; &amp;gt;&amp;gt; /etc/HOSTNAME\n&quot;;
print $inifile &quot;for names in `grep DNS /var/lib/dhcpcd/*info|awk -F= &#39;{print \$2}&#39;`; do\n&quot;;
print $inifile &#39;   echo nameserver $names &amp;gt;&amp;gt; /etc/resolv.conf&#39;.&quot;\n&quot;;
print $inifile &quot;done\n&quot;;

close($inifile);
chmod(0755,&quot;/tmp/xcatinitrd.$$/init&quot;);
chmod(0755,&quot;/tmp/xcatinitrd.$$/bin/netstart&quot;);
@filestoadd=();
foreach (@ndrivers) {
if (-f &quot;$pathtofiles/$_&quot;) {
push @filestoadd,[$_,&quot;lib/$_&quot;];
}
}
foreach (&quot;usr/bin/grep&quot;,&quot;bin/cpio&quot;,&quot;bin/sleep&quot;,&quot;bin/mount&quot;,&quot;sbin/dhcpcd&quot;,&quot;bin/bash&quot;,&quot;sbin/insmod&quot;,&quot;bin/mkdir&quot;,&quot;bin/mknod&quot;,&quot;sbin/ip&quot;,&quot;bin/cat&quot;,&quot;usr/bin/awk&quot;,&quot;usr/bin/wget&quot;,&quot;bin/cp&quot;,&quot;usr/bin/cpio&quot;,&quot;usr/bin/zcat&quot;,&quot;lib/mkinitrd/bin/run-init&quot;) {
getlibs($_);
push @filestoadd,$_;
}
if ($arch =~ /x86_64/) {
push @filestoadd,&quot;lib64/libnss_dns.so.2&quot;;
}
else {
push @filestoadd,&quot;lib/libnss_dns.so.2&quot;;
}
push @filestoadd,keys %libhash;
if($basekernelver ne $kernelver) {
system(&quot;rm -rf $installroot/netboot/$osver/$arch/$profile/rootimg/lib/modules/$basekernelver&quot;);
unless (-d &quot;$installroot/netboot/$osver/$arch/$profile/rootimg/lib/modules/$kernelver&quot;) {
if(-d &quot;/lib/modules/$kernelver&quot;) {
system(&quot;cd /lib/modules;cp -r $kernelver $installroot/netboot/$osver/$arch/$profile/rootimg/lib/modules/&quot;);
}
else {
xdie(&quot;Cannot read /lib/modules/$kernelver&quot;);
}
}
}
find(\&amp;isnetdriver, </code></pre>
<p>If you want to make a stateless install server go to the section on createing an install server somewhere in this wiki... I don't have the URL yet... will fix this later.</p>
</body>
</html>
