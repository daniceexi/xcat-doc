<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
</head>
<body>
<div id="TOC">
<ul>
<li><a href="#debugging-general-issues">Debugging general issues</a><ul>
<li><a href="#verify-xcatd-is-running.">Verify xcatd is running.</a></li>
<li><a href="#xcat-plugin-fails-to-load">xcat plugin fails to load</a></li>
<li><a href="#verify-db-access">Verify DB access</a></li>
<li><a href="#name-resolution">Name resolution</a></li>
<li><a href="#node-deployment-problems">Node deployment problems</a><ul>
<li><a href="#security-ssh-or-xcat-keyscertificates-problem">Security ssh or xcat keys/certificates problem</a></li>
<li><a href="#verify-the-intended-pkgs-are-being-picked-up-during-genimage-or-node-deployment">Verify the intended pkgs are being picked up during genimage or node deployment</a></li>
<li><a href="#service-node-specific">Service Node specific</a></li>
</ul></li>
<li><a href="#provide-xcat-information-for-development">Provide xCAT information for development</a></li>
</ul></li>
<li><a href="#using-xcatdebug-to-trace-xcat-code">Using xcatdebug to Trace xCAT Code</a><ul>
<li><a href="#subroutine-calling-trace">Subroutine calling trace</a></li>
<li><a href="#commented-trace-log">Commented trace log</a></li>
</ul></li>
<li><a href="#how-to-debug-a-general-os-deployment-process">How to debug a general OS deployment process</a><ul>
<li><a href="#network-related-issues">Network Related Issues</a></li>
<li><a href="#setup-domain-name-resolution-dns">Setup Domain Name Resolution DNS</a></li>
<li><a href="#setup-conserver">Setup conserver</a></li>
<li><a href="#dhcp-problems">DHCP problems</a></li>
<li><a href="#postscripts-issues">postscripts issues</a></li>
<li><a href="#syslog-setup-problems">syslog setup problems</a></li>
<li><a href="#ssh-key-setup-problem">ssh key setup problem</a></li>
<li><a href="#otherpkgs-install-problems">Otherpkgs install problems</a></li>
<li><a href="#syncing-files-does-not-work">Syncing files does not work</a></li>
<li><a href="#node-status-incorrect">Node status incorrect</a></li>
<li><a href="#updatenode-problems">updatenode problems</a></li>
<li><a href="#updateflag.awk-failure---port-3002-closed">updateflag.awk failure - port 3002 closed</a></li>
<li><a href="#the-service-node-related-issue">The service node related issue</a></li>
<li><a href="#compute-node-booting-issue">Compute node booting issue</a></li>
<li><a href="#check-dhcp-stack-working-or-not">Check dhcp stack working or not</a></li>
<li><a href="#kernel-panic-during-the-deployment">Kernel panic during the deployment</a></li>
<li><a href="#debug-grub2-problems">Debug grub2 problems</a></li>
</ul></li>
<li><a href="#how-to-debug-a-virtual-machine-management-issue">How to debug a virtual machine management issue</a><ul>
<li><a href="#kvm-problems">kvm problems</a><ul>
<li><a href="#change-the-resource-of-a-vm">Change the resource of a vm</a></li>
<li><a href="#reboot-the-libvirtd-to-handle-the-unknown-problems">Reboot the libvirtd to handle the unknown problems</a></li>
</ul></li>
</ul></li>
<li><a href="#how-to-debug-the-discovery">How to debug the discovery</a><ul>
<li><a href="#discovery-for-system-x">Discovery for system x</a></li>
<li><a href="#how-to-perform-the-discovery">How to perform the discovery</a></li>
</ul></li>
<li><a href="#how-to-boot-up-a-node-with-debug-kernel-for-linux">How to boot up a node with debug kernel for Linux</a></li>
<li><a href="#enable-kdb-for-aix-power-775-nodes">Enable KDB for AIX Power 775 nodes</a></li>
</ul>
</div>
<p><!-- START doctoc generated TOC please keep comment here to allow auto update --> <!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --> Table of Contents</p>
<ul>
<li><a href="#debugging-general-issues">Debugging general issues</a>
<ul>
<li><a href="#verify-xcatd-is-running">Verify xcatd is running.</a></li>
<li><a href="#xcat-plugin-fails-to-load">xcat plugin fails to load</a></li>
<li><a href="#verify-db-access">Verify DB access</a></li>
<li><a href="#name-resolution">Name resolution</a></li>
<li><a href="#node-deployment-problems">Node deployment problems</a></li>
<li><a href="#security-ssh-or-xcat-keyscertificates-problem">Security ssh or xcat keys/certificates problem</a></li>
<li><a href="#verify-the-intended-pkgs-are-being-picked-up-during-genimage-or-node-deployment">Verify the intended pkgs are being picked up during genimage or node deployment</a></li>
<li><a href="#service-node-specific">Service Node specific</a></li>
<li><a href="#provide-xcat-information-for-development">Provide xCAT information for development</a></li>
</ul></li>
<li><a href="#using-xcatdebug-to-trace-xcat-code">Using xcatdebug to Trace xCAT Code</a>
<ul>
<li><a href="#subroutine-calling-trace">Subroutine calling trace</a></li>
<li><a href="#commented-trace-log">Commented trace log</a></li>
</ul></li>
<li><a href="#how-to-debug-a-general-os-deployment-process">How to debug a general OS deployment process</a>
<ul>
<li><a href="#network-related-issues">Network Related Issues</a></li>
<li><a href="#setup-domain-name-resolution-dns">Setup Domain Name Resolution DNS</a></li>
<li><a href="#setup-conserver">Setup conserver</a></li>
<li><a href="#dhcp-problems">DHCP problems</a></li>
<li><a href="#postscripts-issues">postscripts issues</a></li>
<li><a href="#syslog-setup-problems">syslog setup problems</a></li>
<li><a href="#ssh-key-setup-problem">ssh key setup problem</a></li>
<li><a href="#otherpkgs-install-problems">Otherpkgs install problems</a></li>
<li><a href="#syncing--files-does-not-work">Syncing files does not work</a></li>
<li><a href="#node-status-incorrect">Node status incorrect</a></li>
<li><a href="#updatenode-problems">updatenode problems</a></li>
<li><a href="#updateflagawk-failure---port-3002-closed">updateflag.awk failure - port 3002 closed</a></li>
<li><a href="#the-service-node-related-issue">The service node related issue</a></li>
<li><a href="#compute-node-booting-issue">Compute node booting issue</a></li>
<li><a href="#check-dhcp-stack-working-or-not">Check dhcp stack working or not</a></li>
<li><a href="#kernel-panic-during-the-deployment">Kernel panic during the deployment</a></li>
<li><a href="#debug-grub2-problems">Debug grub2 problems</a></li>
</ul></li>
<li><a href="#install-rhels71-ppc64-compute">install rhels7.1-ppc64-compute</a>
<ul>
<li><a href="#ssh-keys-setup-on-node-do-not-work">ssh keys setup on Node do not work</a></li>
</ul></li>
<li><a href="#how-to-debug-a-virtual-machine-management-issue">How to debug a virtual machine management issue</a>
<ul>
<li><a href="#kvm-problems">kvm problems</a></li>
<li><a href="#change-the-resource-of-a-vm">Change the resource of a vm</a></li>
<li><a href="#reboot-the-libvirtd-to-handle-the-unknown-problems">Reboot the libvirtd to handle the unknown problems</a></li>
</ul></li>
<li><a href="#how-to-debug-the-discovery">How to debug the discovery</a>
<ul>
<li><a href="#discovery-for-system-x">Discovery for system x</a></li>
<li><a href="#how-to-perform-the-discovery">How to perform the discovery</a></li>
</ul></li>
<li><a href="#how-to-boot-up-a-node-with-debug-kernel-for-linux">How to boot up a node with debug kernel for Linux</a></li>
<li><a href="#enable-kdb-for-aix-power-775-nodes">Enable KDB for AIX Power 775 nodes</a></li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->

<div class="figure">
<img src="http://sourceforge.net/p/xcat/wiki/XCAT_Documentation/attachment/Official-xcat-doc.png" /><p class="caption"></p>
</div>
<h2 id="debugging-general-issues"><a href="#TOC">Debugging general issues</a></h2>
<h3 id="verify-xcatd-is-running."><a href="#TOC">Verify xcatd is running.</a></h3>
<pre><code>   lsxcatd -a
   export XCATBYPASS=1 to be able to run xcat cmds without xcatd (to look at values and use the perl debugger)
   Restart xcatd with output going to the screen: service xcatd stop; /opt/xcat/sbin/xcatd -f</code></pre>
<h3 id="xcat-plugin-fails-to-load"><a href="#TOC">xcat plugin fails to load</a></h3>
<p>if an xcatd plugin is failing to load:</p>
<pre><code>   cd /opt/xcat/lib/perl/xCAT_plugin
   perl -c -I ../ &lt;plugin.pm&gt;</code></pre>
<p>if the perl -c returns &quot;syntax ok&quot;, check if the plugin.pm ends with a line &quot;1&quot;. When you installed xCAT, did you also use the latest xcat-dep tarball from http://sourceforge.net/projects/xcat/files/xcat-dep/2.x_Linux or http://sourceforge.net/projects/xcat/files/xcat-dep/2.x_AIXÂ ?</p>
<h3 id="verify-db-access"><a href="#TOC">Verify DB access</a></h3>
<pre><code>   tabdump site
   lsxcatd -d</code></pre>
<p>Verify that some key site attributes are correct:</p>
<pre><code>   domain
   master</code></pre>
<p>Verify the <a href="http://xcat.sourceforge.net/man5/networks.5.html">networks table</a> correctly describes the networks in your cluster</p>
<h3 id="name-resolution"><a href="#TOC">Name resolution</a></h3>
<p>Make sure you have name resolution for every defined ip address for the Management Node and the Service Nodes .</p>
<pre><code>   run ifconfig -a | grep inet</code></pre>
<p>Take the list of ips that are output and run getent hosts &lt;ipaddres&gt; make sure each comes back with a resolved hostname If not add the ip address to /etc/hosts See [Cluster_Name_Resolution]</p>
<p>Name resolution issues often cause many problems that are difficult to debug. Some symptoms that have been seen:</p>
<ul>
<li>Statefull (full-disk) installs may hang, fail, or go into &quot;infinite&quot; re-install loops</li>
<li>Diskless and statelite installs may hang, be extremely slow, or have problems running xCAT postscripts</li>
<li>If an /etc/resolv.conf file has an entry that is not reachable during node install or boot, this can cause long delays, timeouts, and hangs.</li>
<li>Hierarchical commands such as xdsh will fail or take a long time to run, if name resolution is not set up correctly on the Management Node and Service nodes.</li>
</ul>
<h3 id="node-deployment-problems"><a href="#TOC">Node deployment problems</a></h3>
<ul>
<li>Display problem node attributes using lsdef</li>
<li>DHCP:
<ul>
<li>tail -f /var/log/messages during node deployment to track DHCP requests, etc.</li>
<li>Are there two dhcp servers running on the same subnet? Check by running this new xcat tool on any node that is connected to the installation network (can be the MN or SN): /opt/xcat/share/xcat/tools/detect_dhcpd -i &lt;network-facing-NIC&gt; *Is dhcp listening on the correct interfaces? Check site.dhcpinterfaces and only specify your cluster-facing network interfaces, then run 'makedhcp -n' to create a new dhcp conf file.</li>
</ul></li>
</ul>
<h4 id="security-ssh-or-xcat-keyscertificates-problem"><a href="#TOC">Security ssh or xcat keys/certificates problem</a></h4>
<ul>
<li>See if ssh &lt;node&gt; date can run w/o prompting for pw</li>
<li>Run xdsh -K to update the ssh keys on the nodes</li>
<li>Run updatenode -k to update keys/certificates on the servicenodes</li>
<li>If nothing else works, run xcatconfig with appropriate flag(-k,-s,-c). See man page <a href="http://xcat.sourceforge.net/man8/xcatconfig.8.html">xcatconfig</a> for what you must do after running these commands.</li>
<li>Check the auditlog xcat table for denials from the policy table</li>
</ul>
<h4 id="verify-the-intended-pkgs-are-being-picked-up-during-genimage-or-node-deployment"><a href="#TOC">Verify the intended pkgs are being picked up during genimage or node deployment</a></h4>
<pre><code>   lsdef &lt;node&gt; \--osimage
   check image table: lsdef -t osimage &lt;osimage&gt;</code></pre>
<p>Verify all necessary linux services are running</p>
<pre><code>   tftp, nfs, http, dhcp, conserver, named
   Verify no file systems are full on MN or SNs
   Verify SELinux is disabled, especially on RHEL*</code></pre>
<h4 id="service-node-specific"><a href="#TOC">Service Node specific</a></h4>
<ul>
<li><p>Verify it can access the db on the MN and that the /etc/xcat/cfgloc contents is correct ~~~~ lsxcatd -a ~~~~</p></li>
<li><p>Make sure the xCAT versions are the same on MN and SNs ~~~~ lsxcatd -a on MN and SN ~~~~</p></li>
<li><p>Make sure the date/time is the same between the MN and SNs</p></li>
</ul>
<p>If /install is not mounted on the SN, make sure it is sync'd to all the SNs</p>
<p>AIX specific: *Is DHCP running on NIM master? Isn't this needed on the p775 EMS?</p>
<h3 id="provide-xcat-information-for-development"><a href="#TOC">Provide xCAT information for development</a></h3>
<p>*Run xcatsnap and send to the xCAT development team</p>
<h2 id="using-xcatdebug-to-trace-xcat-code"><a href="#TOC">Using xcatdebug to Trace xCAT Code</a></h2>
<p>A new command <a href="http://xcat.sourceforge.net/man8/xcatdebug.8.html">xcatdebug</a> was introcuded in 2.7 for the admin to enable the trace for the xcatd daemon and plugins.</p>
<p>xcatdebug offers two trace facilities to debug the xCAT:</p>
<h3 id="subroutine-calling-trace"><a href="#TOC">Subroutine calling trace</a></h3>
<p>Display the calling trace for subroutine when it is called.</p>
<p>The flag -c is used to specify the subroutine list for subroutine calling trace, it can only work with -f. The value of -c can be a configuration file or a subroutine list.</p>
<pre><code> configuration file: a file contains multiple lines of SUBROUTINE_DEFINITION
 subroutine list:    SUBROUTINE_DEFINITION|SUBROUTINE_DEFINITION|...</code></pre>
<p>SUBROUTINE_DEFINITION: is the element for the -c to specify the subroutine list.</p>
<p>The format of SUBROUTINE_DEFINITION: <a href="subroutine1,subroutine2,...">plugin</a></p>
<p>If ignoring the [plugin], the subroutines in the () should be defined in the xcatd.</p>
<pre><code>   e.g. (daemonize,do_installm_service,do_udp_service)</code></pre>
<p>Otherwise, the package name of the plugin should be specified.</p>
<pre><code>   e.g. xCAT::Utils(isMN,Version)
   e.g. xCAT_plugin::DBobjectdefs(defls,process_request)</code></pre>
<p>The trace log will be written to /var/log/xcat/subcallingtrace. The log file subcallingtrace will be backed up for each running of the xcatdebug -f enable.</p>
<p>Enable the subroutine calling trace for all the subroutines in the xcatd and plugin modules.</p>
<pre><code>    xcatdebug -f enable</code></pre>
<p>Enable the subroutine calling trace for the plugin_command in xcatd and defls,process_request in the xCAT_plugin::DBobjectdefs module.</p>
<pre><code>    xcatdebug -f enable -c &quot;xCAT_plugin::DBobjectdefs(defls,process_request)|(plugin_command)&quot;</code></pre>
<h3 id="commented-trace-log"><a href="#TOC">Commented trace log</a></h3>
<p>The trace log code is presented as comments in the code of xCAT. In general mode, it will be kept as comments. But in debug mode, it will be commented back as common code to display the trace log.</p>
<p>This facility offers two formats for the trace log code:</p>
<p>Trace section</p>
<pre><code>    ## TRACE_BEGIN
    # print &quot;In the debug\n&quot;;
    ## TRACE_END</code></pre>
<p>Trace in a single line</p>
<pre><code>     ## TRACE_LINE print &quot;In the trace line\n&quot;;</code></pre>
<p>Enable the commented trace log</p>
<pre><code>    xcatdebug -d enable</code></pre>
<p>This facility also can be enabled by passing the ENABLE_TRACE_CODE=1 global variable when running the xcatd.</p>
<pre><code>    ENABLE_TRACE_CODE=1 xcatd -f</code></pre>
<h2 id="how-to-debug-a-general-os-deployment-process"><a href="#TOC">How to debug a general OS deployment process</a></h2>
<h3 id="network-related-issues"><a href="#TOC">Network Related Issues</a></h3>
<p>*Look at syslog on the MN</p>
<pre><code> *By default the syslog is written into the file /var/log/messages. You can tail -f it to watch new entries as your nodes deploy.</code></pre>
<p>Following messages should be noticed:</p>
<ul>
<li><p>DHCP - The dhcpd on MN/SN should get the dhcp request from node and send back the offer/ack to the node. If no dhcp request is received: 1. try to make sure the node is attempting to boot from network (not its local disk); 2. verify the dhcp server has been started. (for bootp on aix, it will be start by xinetd automatically)</p></li>
<li><p>atftp - To see whether the bootloader file xnba.kpxe/pxelinux.0/yaboot has been transferred to the node.</p></li>
</ul>
<p>If the syslog postscript runs correctly for the SN/CN, then after that you will also see the syslog messages redirected from SN/CN to the MN.</p>
<p>Look at /etc/dhcpd.conf and /var/lib/dhcpd/dhcpd.leases * /etc/dhcpd.conf (on RHEL6, this is in /etc/dhcp/dhcpd.conf) - Verify it has the correct stanza for the MN/SN's installation nic. (The dynamic rage should only be used for the discovery process.) This stanza was created by <a href="http://xcat.sourceforge.net/man8/makedhcp.8.html">makedhcp -n</a> and is also affected by the <a href="http://xcat.sourceforge.net/man5/site.5.html">site.dhcpinterfaces</a> attribute. * /var/lib/dhcpd/dhcpd.leases - verify it has the correct section for each node. the mac and assigned IP should be included. These entries were created by <a href="http://xcat.sourceforge.net/man8/makedhcp.8.html">makedhcp -a</a> (or makedhcp &lt;noderange&gt;).</p>
<p>The files in the /tftpboot</p>
<pre><code>* The bootloader, configuration file of bootloader, initrd and osimage are located in the /tftpboot. Make sure they have been generated successfully before the starting of installation.

*For netboot with yaboot: the file &#39;yaboot&#39; should be installed in /tftpboot. The configuration files should be genreated in the /tftpboot/etc/ with node name.
*For netboot with pxe: the file &#39;pxelinux.0&#39; should be installed in /tftpboot. The configuration files should be generated in the /tftpboot/pxelinux.cfg/ with node name.</code></pre>
<p>For netboot with xnba: the files nbfs.&lt;arch&gt;.gz and nbk.&lt;arch&gt; should be installed in /tftpboot/xcat. The configuration files should be generated in the /tftpboot/xcat/xnba/nodes/&lt;node&gt; with node name. *Note: If the kernel or initrd/osimage can not be loaded correctly, look in the bootloader configuration file to verify that the files IP/Path/file_names have been installed.</p>
<p>Look in the log of the http server</p>
<p>During the OS deployment, some files will be transported by http. Monitoring the http log could help for debugging.</p>
<p>The location of http log - For readhat: /var/log/httpd/access_log; For sles: /var/log/apache2/access_log If you use the xnba as boot method, the kernel, image will be gotten from http. If you failed to get xnba file and get error messages such as &quot;Filename: http://172.20.0.11/tftpboot/xcat/xnba/nodes/cn</p>
<p>http://172.20.0.11/tftpboot/xcat/xnba/nodes/cn... Connection reset&quot; . Try to check 1)if firewall is stopped. 2) if httpd is running.</p>
<p>For diskfull, the kickstart configuration and installed packages will be gotten from http.</p>
<p>The installation configuration file /install/autoinst/&lt;node&gt;</p>
<p>This file will be generated for diskfull installation after the running of 'nodeset &lt;node&gt; install'.</p>
<p>Check the following part to work out possible problems:</p>
<pre><code>       url
       packages
       pre
       post</code></pre>
<h3 id="setup-domain-name-resolution-dns"><a href="#TOC">Setup Domain Name Resolution DNS</a></h3>
<p>The hostname of SN/CN should can be resolved from MN. And the hostname of MN/SN should can be resolved from CN. See [Cluster_Name_Resolution]</p>
<p>You should can run the command 'nslookkup node' to see whether the dns setup for the node has been done. If you don't want to use dns, just run 'ping node' to see the IP of node has been worked out by ping command.</p>
<p>Run following command to setup DNS, see man page for options and [Cluster_Name_Resolution].</p>
<pre><code>   makedns</code></pre>
<h3 id="setup-conserver"><a href="#TOC">Setup conserver</a></h3>
<p>Run rcons to open the console to monitor the installation process.</p>
<p>If 'rcons node' encountered problem, try following methods:</p>
<p>Run 'makeconservercf' to add the the node into the configuration file of conserver. Check configuration file of conserver /etc/conserver.cf to see if node is added.</p>
<pre><code>      :For cn managed by hmc, the configuration file should be like
        #xCAT BEGIN cn CONS
        console cn {
          type exec;
          exec /opt/xcat/share/xcat/cons/hmc cn;
        }
        #xCAT END cn CONS
        #
      :For cn managed by BMC with IPMI, the configuration file should be like
        #xCAT BEGIN cn CONS
        console cn {
          type exec;
          exec /opt/xcat/share/xcat/cons/ipmi cn;
        }
        #xCAT END cn CONS
      :For virtual machine managed by kvm, the configuration file should be like
        #xCAT BEGIN cn CONS
        console cn {
          type exec;
          exec /opt/xcat/share/xcat/cons/kvm cn;
        }
        #xCAT END cn CONS
       :For cn managed by fsp, the configuration file should be like
         #xCAT BEGIN lpar1 CONS
         console lpar1 {
           type exec;
           exec /opt/xcat/share/xcat/cons/fsp lpar1;
         }
         #xCAT END lpar1 CONS
</code></pre>
<p>If you node are system x node, you may hit error &quot;@localhost: Connection refused&quot;, please check node definition and make sure your node has following attributes.</p>
<pre><code>       serialflow=hard
       serialport=0
       serialspeed=115200</code></pre>
<p>Run 'service conserver reset' to resolve the certificate key issue.</p>
<p>Check the validation of attributes in the tables</p>
<p>If you encountered some issues that do not have hit to figure out the cause, try to check the attributes in following tables.</p>
<p>Table Site: master, domain, nameserver,dhcpinterfaces Table networks: Has the installation network defined in. Table noderes: netboot, tftpserver,nfsserver,installnic,primarynic Table nodetype: os,arch,profile</p>
<h3 id="dhcp-problems"><a href="#TOC">DHCP problems</a></h3>
<p>Should not have multiple dhcpd daemons in one network/vlan</p>
<p>If there are two or more dhcpd daemons in the installation network/vlan responding to node requests, it will cause strange issues, so you should verify that there is only one dhcp server in the network. This can be done by running a new xcat tool on any node that is connected to the installation network (can be the MN or SN):</p>
<pre><code>   /opt/xcat/share/xcat/tools/detect_dhcpd -i &lt;network-facing-NIC&gt;</code></pre>
<h3 id="postscripts-issues"><a href="#TOC">postscripts issues</a></h3>
<p>Login the compute node and check:</p>
<ol style="list-style-type: decimal">
<li><p>Is /xcatpost created and the postscripts are downloaded correctly? If the /xcatpost is not created, there might be some network problems between the compute node and management node. For SLES, check the /var/adm/autoinstall/scripts/ and /var/adm/autoinstall/logs/.</p></li>
<li><p>the content of following script files, to see whether the exported environment variable has correct value and the postscripts have been added correctly.</p></li>
</ol>
<p>Linux: /xcatpost/mypostscript, /xcatpost/mypostscript.post AIX: /xcatpost/myxcatpost_<nodename></p>
<p>A specific postscript is not run during the installation</p>
<p>Make it has been added into the postscripts.postscripts or postscripts.postbootscripts Make sure it has been copied to the /install/postscripts. Make sure the permission on the file is world readable and executable by root.</p>
<h3 id="syslog-setup-problems"><a href="#TOC">syslog setup problems</a></h3>
<p>All node syslogs are sent to the Management node by default. As default, the syslog message from the node will be redirected to the management node. Make sure the syslog postscript has been added into the postscripts attribute.</p>
<p>Look into configuration file of syslog: /etc/(r)syslog.conf (rh), /etc/syslog-ng/syslog-ng.conf (sles).</p>
<h3 id="ssh-key-setup-problem"><a href="#TOC">ssh key setup problem</a></h3>
<p>Cannot login the node without entering a password.</p>
<pre><code> Usually, the &#39;remoteshell&#39;(linux) or &#39;aixremoteshell&#39;(AIX) was not run correctly for the node. Make sure node can be resolved from management, and management node can be resolved from node.</code></pre>
<h3 id="otherpkgs-install-problems"><a href="#TOC">Otherpkgs install problems</a></h3>
<p>Linux: The packages listed in the otherpkgs are not installed on the node</p>
<p>Make sure the path and name of otherpkgs configuration file are correct. Path: /opt/xcat/share/xcat/netboot(install)/&lt;platform&gt;/profile.&lt;os&gt;.&lt;arch&gt;.otherpkgs.pkglist Make sure the packages have been copied to correct path. Path: /install/post/otherpkgs/&lt;os&gt;/&lt;arch&gt;/xcat</p>
<p>AIX: The packages listed in the installp_bundle and otherpkgs are not installed on the node</p>
<p>Make sure the installp_bundle or otherpkgs has been configured to the nimimage. 1. Wirte into table nimimage. 2. Put as parameter for 'nimnodeset' command. Make sure the installp and rpm packages have been updated to the nimimage.</p>
<h3 id="syncing-files-does-not-work"><a href="#TOC">Syncing files does not work</a></h3>
<p>The files listed in the synclist are not synced to the node</p>
<p>Make sure the synclist configuration file has correct format. Refer to the doc [Sync-ing_Config_Files_to_Nodes].</p>
<h3 id="node-status-incorrect"><a href="#TOC">Node status incorrect</a></h3>
<p>After the installation, the 'status' attribute is not changed to 'booted' Make sure the process 'xcatd: install monitor' has been started correctly.</p>
<pre><code>     ps -ef | grep xcatd</code></pre>
<h3 id="updatenode-problems"><a href="#TOC">updatenode problems</a></h3>
<p>For debugging updatenode problems, see <a href="Using_Updatenode/#appendix-c-debugging-tips">Using_Updatenode#Debugging_Tips</a>.</p>
<h3 id="updateflag.awk-failure---port-3002-closed"><a href="#TOC">updateflag.awk failure - port 3002 closed</a></h3>
<p>Check to see if the install monitor pid is running on the MN.</p>
<pre><code>    ps axf|grep -i xcatd</code></pre>
<p>If you see 'install monitor', then</p>
<pre><code>    lsof -p &lt;pid&gt;</code></pre>
<p>A good tool to install is NetCat:</p>
<pre><code>    nc-1.84-22.el6.ppc64</code></pre>
<p>You can stop xcatd and then run the tool and see if it can open the port</p>
<pre><code>    nc -l 3002</code></pre>
<p>Then if you can start xcatd and see it cannot open the port:</p>
<pre><code>    /opt/xcat/sbin/xcatd -f
    Starting vsftpd for vsftpd:                               [  OK  ]
    xcatd unable to open install monitor services on 3002
    Died at /opt/xcat/sbin/xcatd line 262.
    -------startMonitoring: product_names=</code></pre>
<h3 id="the-service-node-related-issue"><a href="#TOC">The service node related issue</a></h3>
<pre><code> For a service node, at least the servicenode.tftpserver attribute should be set to &#39;1&#39;, otherwise it will not be configured as a service node.</code></pre>
<p>Some specific postscripts are not run</p>
<pre><code> There are several postscripts will be run for the service node: servicenode, xcatserver (only for Linux) and xcatclient (only for Linux). If you found certain of these postscript was not run, check whether the node has been added into the &#39;service&#39; group. Or check whether the scirpts have been added into the &#39;postscripts&#39; attribute.</code></pre>
<p>The xCAT rpm packages are not installed on the service node</p>
<p>For linux, make sure you have used the 'service' as the profile for the node. And copy the xcat-core and xcat-dep which untared from the xCAT installation packages into the path: /install/post/otherpkgs/&lt;os&gt;/&lt;arch&gt;/xcat. For AIX, make sure the correct installp_bundle for service node has been added for the node. And updated the related installp or rpm packages for the nimimage.</p>
<p>The xcatd cannot start</p>
<pre><code> For service node, only the database which supporting the remote access can be used. The supported database: Mysql, Postgresql, DB2. The database on service node should be setup correctly to access the xCAT DB on the management node, otherwise the xcatd cannot start up correctly. Refer to the database configuration doc for the verification.</code></pre>
<p>Some specific servers are not started</p>
<p>Make sure the xcatd has been started. Make sure the the services have been set in the servicenode table.</p>
<h3 id="compute-node-booting-issue"><a href="#TOC">Compute node booting issue</a></h3>
<p>*Add drucat debug shell support</p>
<pre><code> After nodeset to the compute node, add &quot;rdshell&quot; and &quot;rdinitdebug&quot; to kernel parameters in /tftpboot/pxelinux.cfg/&amp;lt;cn&amp;gt;, these two parameters will make the kernel start a shell if any error happens during boot.
 So you can debug in the shell to see if the ip addresses have been configured and if the rootimage can be downloaded from MN/SN
 If any tools are not available on CN, mount a directory with toolkits from SN/MN.

 The /tftpboot/pxelinux.cfg/&amp;lt;cn&amp;gt; file will be something like:</code></pre>
<ol style="list-style-type: decimal">
<li>install rhels6.1-x86_64-kvm</li>
</ol>
<p>DEFAULT xCAT LABEL xCAT</p>
<pre><code>    KERNEL xcat/rhels6.1/x86_64/vmlinuz
    APPEND initrd=xcat/rhels6.1/x86_64/initrd.img quiet tmpfs_size=2G  repo=http://192.168.5.84/install/rhels6.1/x86_64/ ks=http://192.168.5.84/install/autoinst/x3550xcat ksdevice=eth0 cmdline console=tty0 console=ttyS0,19200n8r rdshell rdinitdebug
     IPAPPEND 2</code></pre>
<h3 id="check-dhcp-stack-working-or-not"><a href="#TOC">Check dhcp stack working or not</a></h3>
<pre><code> Since the login node can boot up after changing the initrd, it is more like dhclient rpm is not installed correctly in the bad initrd, you can check the section of installing additional HFI related packages in our pLinux doc to see if there is any hints.

 A good way to debug dhcp problem is to trigger a dhcp request on the compute node and see what we can get from server. The command to trigger a dhcp request on compute node:

 In the rdshell on compute node that created by above step, check if /etc/dhclient.conf and /tmp/dhclient.eth0.lease exist. If they do, issue:</code></pre>
<pre><code>       dhclient -4 -1 -q -cf /etc/dhclient.conf -pf /tmp/dhclient.eth0.pid -lf /tmp/dhclient.eth0.lease eth0</code></pre>
<pre><code> If we are not getting too many syslog entries  on dhcp server, we can trigger a dhcp request and use tcpdump -w option on service node or management node to log all the network communication and parse the network log for analysis.

 Also if it is initrd prolbem on System P servers, you can extract the two initrd and compare the dhcp/dhclient related binaries size directly to see if there is any hint.

 The way to extract initrd:</code></pre>
<pre><code>       gunzip initrd-stateless.gz
       mkdir 1
       cd 1
       cpio -id &lt;node&gt; serialflow=</code></pre>
<pre><code>2\. Unset all the serial console related attributes:</code></pre>
<pre><code>      chdef &lt;node&gt; serialport= serialspeed= serialflow=</code></pre>
<pre><code>3\. Revert the console parameter order:
Get in the pxe/xnba configuration file (/tftpboot/xcat/xnba/nodes/&amp;lt;node&amp;gt;, /tftpboot/pxelinux.cfg/&amp;lt;node&amp;gt;), revert the order of console parameters:</code></pre>
<pre><code>      Change from
        &#39;console=tty0 console=ttyS0,115200&#39;
      To
        &#39;console=ttyS0,115200 console=tty0&#39;</code></pre>
<h3 id="kernel-panic-during-the-deployment"><a href="#TOC">Kernel panic during the deployment</a></h3>
<pre><code> This may be caused by the &#39;console&#39; configuration in the kernel parameters which set by xCAT. You could try one of the following tips as a work around:
1\. Unset all the serial console related attributes:</code></pre>
<pre><code>      chdef &lt;node&gt; serialport= serialspeed= serialflow=</code></pre>
<pre><code>2\. Try the another serial port:</code></pre>
<pre><code>      chdef &lt;node&gt; serialport=&lt;another serial port&gt;</code></pre>
<p>Note: You have to run the 'nodeset' after the above setting.</p>
<h3 id="debug-grub2-problems"><a href="#TOC">Debug grub2 problems</a></h3>
<p>grub2 has a debug option which could be specified in the /tftpboot/boot/grub2/grub.cfg-<mac>, here is an example, the set debug=all enables the grubs debug.</p>
<p>~~~~ [root@c910f02c01p02 grub2]# cat /tftpboot/boot/grub2/grub.cfg-01-e6-d4-dd-f8-1d-03 #install rhels7.1-ppc64-compute set debug=all set timeout=5 set default=&quot;xCAT OS Deployment&quot; menuentry &quot;xCAT OS Deployment&quot; { insmod http insmod tftp set root=tftp,10.2.1.2 echo Loading Install kernel ... linux /xcat/osimage/rhels7.1-ppc64-install-compute/vmlinuz quiet inst.repo=http://10.2.1.2:80/install/rhels7.1/ppc64 inst.ks=http://10.2.1.2:80/install/autoinst/c910f02c01p03 BOOTIF=e6:d4:dd:f8:1d:03 ip=dhcp echo Loading initial ramdisk ... initrd /xcat/osimage/rhels7.1-ppc64-install-compute/initrd.img } [root@c910f02c01p02 grub2]# ~~~~ ### ssh keys setup on Node do not work</p>
<p>Check to make sure SELinux is disable on the node.</p>
<h2 id="how-to-debug-a-virtual-machine-management-issue"><a href="#TOC">How to debug a virtual machine management issue</a></h2>
<h3 id="kvm-problems"><a href="#TOC">kvm problems</a></h3>
<p>Using the xnba instead of pxe as the netboot method.</p>
<p>Check the xCAT DB</p>
<p>Following xCAT tables are have definition information for virtual machine:</p>
<p>Table vm: Includes most of the information of a virtual machine Table vmmater: If you are trying to do the clonevm, the vmmaster table needs to be used. Table kvm_nodedata. After the mkvm of a vm. You can find the kvm definition has been added in the kvm_nodedata.xml. Show it by 'nodels &lt;vm&gt; kvm_nodedata.xml'.</p>
<p>Check the location and permission of storage (nfs://)</p>
<p>The nfs server can be set on MN or KVM hypervisor, pay attention to the permission of the storage path.</p>
<p>Set the model of storage and nic</p>
<p>Model of storage: default is 'dh'. The others valid value: scsi, virtio Model of nic: default is e1000. The others valid value: rtl8139, virtio</p>
<p>Use the vnc to display the vm console</p>
<pre><code>The vnc port is opened when the vm is runing. You can open the vnc of vm by following approaches:</code></pre>
<pre><code>      ssh -X to the kvm hypervisor,
      vnc login to the kvm hypervisor,
      Run &#39;vncviewer localhost:&amp;lt;vnc port&amp;gt;&#39; to open the vnc to the vm.
    Note: the &amp;lt;vnc port&amp;gt; can be found from the &#39;lsdef vm&#39; after the &#39;mkvm&#39; run for the node.</code></pre>
<p>Use the virsh to debug</p>
<pre><code>   virsh list - display the running vm
   virsh dumpxml - dump the definition of vm
   virsh start &lt;dom&gt; \- start the vm
   virsh destroy &lt;dom&gt; \- destroy a vm</code></pre>
<p>Check the network process</p>
<p>Look into the definition of bridge, as default it is br0. The configuration file /etc/sysconfig/network-scripts/ifcfg-br0 should includes following lines:</p>
<pre><code>           DEVICE=br0
           TYPE=Bridge
           ONBOOT=yes
           BOOTPROTO=dhcp
           PEERDNS=yes
           DELAY=0</code></pre>
<p>Look into the definition of nic which configured for bridge. The configuration file /etc/sysconfig/network-scripts/ifcfg-eth0 (Use eth0 as example) should includes following lines:</p>
<pre><code>           DEVICE=eth0
           TYPE=Ethernet
           ONBOOT=yes
           BRIDGE=br0
           PROMISC=yes
           HWADDR=e4:1f:13:65:31:e8</code></pre>
<p>Display the configuration of bridge</p>
<pre><code>        # brctl  show
        bridge name     bridge id               STP enabled     interfaces
        br0             8000.e41f136531e8       no              eth0
                                                                vnet0
                                                                vnet1
                                                                vnet2
</code></pre>
<p>Reset the network if you have changes for the network on kvm hypervisor</p>
<pre><code>       service network reset</code></pre>
<h4 id="change-the-resource-of-a-vm"><a href="#TOC">Change the resource of a vm</a></h4>
<p>Following resources can be changed for a vm: cpu, memory, disk, nic.</p>
<pre><code> Note: Certain changes need to reboot the vm or rmvm/mkvm again.</code></pre>
<p>Look into the qemu log when start a vm</p>
<p>From the log, you can figure out which command is running when creating the virtual machine.</p>
<pre><code>        /var/log/libvirt/qemu/&lt;vm&gt;.log</code></pre>
<h4 id="reboot-the-libvirtd-to-handle-the-unknown-problems"><a href="#TOC">Reboot the libvirtd to handle the unknown problems</a></h4>
<pre><code> Note: Reboot the libvirtd will cause all the running vm to be stopped.</code></pre>
<h2 id="how-to-debug-the-discovery"><a href="#TOC">How to debug the discovery</a></h2>
<h3 id="discovery-for-system-x"><a href="#TOC">Discovery for system x</a></h3>
<p>The discovery of the node can be used to map the node definition of xCAT to the physical node. After discovery the following attributes will be set for the node definition: bmcpassword,mac,mtm,serial.</p>
<p>After the discovery, if the mac was not filled automatically, check the switch and switches tables has been configured correctly</p>
<p>Hardware discovery for the System x machines need the physical network connection (The mapping of the node and the port of switch that the node directly connected to) information to perform.</p>
<p>Show the switch related attributes for the node. If not set, try to set it correctly.</p>
<pre><code>    lsdef &lt;node&gt; -i switch,switchport</code></pre>
<p>Add the correct access entry for the switch in the 'switches' table. The attributes snmpversion,username,password should be set at least.</p>
<p>Check snmp has been enabled for the switches</p>
<p>Run following command try to get the 'description information of this switch'. If failed, you need to check the configuration of the switch.</p>
<pre><code>    snmpget -v 3 -a sha -u &lt;username&gt; -A &lt;password&gt; -X &lt;password&gt; -l authNoPriv &lt;host of switch&gt; .1.3.6.1.2.1.1.1.0</code></pre>
<p>Check the dynamic range has been added into the dhcpd.conf for the correct network interface. If not:</p>
<pre><code>    chdef -t network &lt;networkname&gt; dynamicrange=startip-endip
    makedhcp -n
    service dhcpd restart</code></pre>
<p>Check the fixed IP configured in the configuration file dhcpd.leases has been removed</p>
<p>If not removed, run:</p>
<pre><code>    makedhcp -d &lt;node&gt;
    service dhcpd restart
    And check again!</code></pre>
<p>Check the nbk.&lt;arch&gt; and nbfs.&lt;arch&gt; have been created in the /tftpboot/xcat</p>
<h3 id="how-to-perform-the-discovery"><a href="#TOC">How to perform the discovery</a></h3>
<p>Monitoring the status of the discovery from syslog: tail -f /var/log/messages</p>
<p>Walk over to systems, hit power buttons, then monitoring the following messages from /var/log/messages:</p>
<p>The discovery has been triggered for the node: xcatd: Processing discovery request from &lt;dynamic IP of the node&gt; The discovery for the node has succeeded: &lt;node&gt; has been discovered</p>
<p>After the discovery</p>
<p>Check the attributes have been updated for the node. Especially the mac.mac.</p>
<p>Check the command 'rpower &lt;node&gt; stat' can get the correct status output.</p>
<p>Then run the makedhcp/nodeset/rpower to boot the node.</p>
<h2 id="how-to-boot-up-a-node-with-debug-kernel-for-linux"><a href="#TOC">How to boot up a node with debug kernel for Linux</a></h2>
<ol style="list-style-type: decimal">
<li>Add the debug kernel to the pkglist:</li>
</ol>
<pre><code>     kernel-debug
     kernel-debug-debuginfo
     kernel-debug-devel
     kernel-debuginfo
     kernel-debuginfo-common
     kernel-devel</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Run genimage</li>
</ol>
<p>2.1) For xCAT 2.8.3 and later</p>
<pre><code>     genimage &lt;imagename&gt; -k 2.6.32-220.7.6.p7ih.el6.ppc64.debug -g 2.6.32-220.7.6.p7ih.el6.ppc64</code></pre>
<p>2.2) Before xCAT 2.8.3</p>
<pre><code>     genimage &lt;imagename&gt;</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Run packimage for stateless or liteiamge for statelite image</li>
</ol>
<pre><code>     packimage &lt;imagename&gt;</code></pre>
<p>or</p>
<pre><code>     liteimage &lt;imagename&gt;</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Run geninitrd and specify the debug kernel</li>
</ol>
<p>Note: Ignore this step for xCAT 2.8.3 and later.</p>
<p>For example:</p>
<pre><code>     /opt/xcat/share/xcat/netboot/rh/geninitrd -i hf0 -n hf_if -o rhels6 -k 2.6.32-220.7.6.p7ih.el6.ppc64.debug -p compute</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Run nodeset to assign the image to the node</li>
</ol>
<pre><code>     nodeset &lt;noderange&gt; osimage=&lt;imagename&gt;</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Deploy the node</li>
</ol>
<h2 id="enable-kdb-for-aix-power-775-nodes"><a href="#TOC">Enable KDB for AIX Power 775 nodes</a></h2>
<p>This procedure has been used to enable KDB for AIX Power 775 lpars:</p>
<pre><code>   xcatchroot -i &lt;osimage&gt; &quot;bosdebug -D&quot;
   nim -o check &lt;osimage&gt;</code></pre>
<pre><code> This does the equivalent of &quot;bosboot -a&quot; with a reboot, which is what is normally required to make it take affect on a diskfull node</code></pre>
<pre><code>   xcatchroot -i &lt;osimage&gt; &quot;bosdebug -L&quot;</code></pre>
<pre><code>Should show:</code></pre>
<pre><code>      Memory debugger           off
      Memory sizes              0
      Network memory sizes      0
      Kernel debugger           on</code></pre>
</body>
</html>
