<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
</head>
<body>
<div id="TOC">
<ul>
<li><a href="#document-abstract">Document Abstract</a></li>
<li><a href="#user-access-control">User Access Control</a></li>
<li><a href="#no-root-login">No Root Login</a></li>
</ul>
</div>
<p><!-- START doctoc generated TOC please keep comment here to allow auto update --> <!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --> Table of Contents</p>
<ul>
<li><a href="#document-abstract">Document Abstract</a></li>
<li><a href="#user-access-control">User Access Control</a></li>
<li><a href="#no-root-login">No Root Login</a></li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->

<div class="figure">
<img src="http://sourceforge.net/p/xcat/wiki/XCAT_Documentation/attachment/Official-xcat-doc.png" /><p class="caption"></p>
</div>
<h2 id="document-abstract"><a href="#TOC">Document Abstract</a></h2>
<p>This document provides a guide to security for xCAT on z/VM and Linux on System z. For technical support, please post your question(s) on the <a href="https://lists.sourceforge.net/lists/listinfo/xcat-user">mailing-list</a>.</p>
<h2 id="user-access-control"><a href="#TOC">User Access Control</a></h2>
<p>This section provides details on how to add users to xCAT and limit the scope of their usage.</p>
<p>In order to add a user to xCAT, you must modify two xCAT tables: policy and passwd. Below are the instructions on how to modify these tables.</p>
<ol style="list-style-type: decimal">
<li><p>Create an entry for the new user in the policy table.</p>
<pre><code># chtab priority=6.1 policy.name=joe policy.rule=allow</code></pre></li>
</ol>
<p>The policy table controls which commands a user can run and which nodes the user can access. There is a unique priority number for each user. You must verify that the priority number you have chosen is not in use by viewing the existing policies in the policy table (<code>tabdump policy</code>). In the example above, a user named joe is added with a priority number of 6.1.</p>
<ol start="2" style="list-style-type: decimal">
<li><p>By default, a user is allowed to run all xCAT commands. To restrict a user to a specific set of commands, the policy.commands attribute must be modified to contain the specific set of commands. A complete list of xCAT commands can be found at <a href="http://xcat.sourceforge.net/man1/xcat.1.html">this link</a>.</p>
<pre><code># chtab priority=6.1 policy.commands=&quot;rpower,mkvm,rmvm,lsvm,chvm,mkdef,lsdef,rscan,rinv,nodeadd&quot;</code></pre></li>
</ol>
<p>Multiple commands can be specified. Each command has to be separated by a comma. Be sure to use the correct priority number when setting the commands. Otherwise, you might be overriding the policy of another user.</p>
<ol start="3" style="list-style-type: decimal">
<li><p>xCAT encrypts its password using MD5 hashes. To generate an MD5 hashed password, you can use the Perl crypt routine.</p>
<pre><code># perl -e &quot;print crypt(&#39;rootpw&#39;, rand(12345678))&quot;
48aVyK0x4vqCc</code></pre></li>
</ol>
<p>The password being encrypted is rootpw. It uses the Perl crypt routine with a random number between 0 and 12345678 as a seed.</p>
<ol start="4" style="list-style-type: decimal">
<li><p>Create an entry for the new user in the passwd table using the encrypted password created above</p>
<pre><code># chtab username=joe passwd.key=xcat passwd.password=48aVyK0x4vqCc</code></pre></li>
</ol>
<p>More information can be found on granting xCAT user privileges by going to <a href="https://sourceforge.net/apps/mediawiki/xcat/index.php?title=Granting_Users_xCAT_privileges">this link</a>.</p>
<h2 id="no-root-login"><a href="#TOC">No Root Login</a></h2>
<p>This section provides details on how to setup a non-root login for xCAT and virtual machines provisioned by xCAT.</p>
<p>In some environments, system administrators cannot use root to access and manage their systems. The following setup provides an alternative way (via a sudoer) to access and manage systems.</p>
<ol style="list-style-type: decimal">
<li><p>Create a non-root user (xcat) on the xCAT MN.</p>
<pre><code># /usr/sbin/userdel xcat
# /usr/sbin/useradd -p rootpw -m xCAT</code></pre></li>
<li><p>Add the user to the sudoers list.</p>
<pre><code># echo &quot;xcat ALL=(ALL) NOPASSWD: ALL&quot; &amp;gt;&amp;gt; /etc/sudoers</code></pre></li>
</ol>
<p>The sudoer can be customized to run only a small set of commands. In this example,</p>
<pre><code>* xcat - User name
* ALL= - From any Host/IP
* (ALL) - Can run as any user
* NOPASSWD: - No password required
* ALL - All commands accepted</code></pre>
<p>If you are running RHEL, an extra line must be added in the sudoers file.</p>
<pre><code>    # echo &quot;Defaults:xcat !requiretty&quot; &amp;gt;&amp;gt; /etc/sudoers</code></pre>
<ol start="3" style="list-style-type: decimal">
<li><p>xCAT runs as root, but users can log into xCAT as a sudoer. Once a sudoer is created, add the sudoer to the xCAT policy and passwd tables.</p>
<pre><code># chtab priority=1.3 policy.name=xcat policy.rule=allow policy.comments=&quot;privilege:root;&quot;
# perl -e &quot;print crypt(&#39;rootpw&#39;, rand(12345678))&quot;
48aVyK0x4vqCc

# chtab username=xcat passwd.key=xcat passwd.password=48aVyK0x4vqCc</code></pre></li>
</ol>
<p>In order for the sudoer (xcat) to access the xCAT UI, you must add &quot;privilege:root;&quot; into the policy.comments.</p>
<ol start="4" style="list-style-type: decimal">
<li><p>To manage other virtual machines (including the zHCP) via a sudoer, you have to create a non-root user (xcat) on each virtual machine and add the sudoer to the sudoers list (as above). There is a script on the xCAT MN, /install/postscripts/sudoer, that can be run to create the sudoer.</p>
<pre><code>updatenode zhcp -P sudoer</code></pre></li>
</ol>
<p>In order for updatenode to run the postscript, the public SSH key (id_rsa.pub) must already be setup on the target virtual machine. The postscript create a sudoer with a user name of <em>xcat</em> and a password of <em>rootpw</em>. The username and password contained in the sudoer script can be modified to suit your needs.</p>
<ol start="5" style="list-style-type: decimal">
<li><p>To create a sudoer for any newly provisioned virtual machine, you have to add the sudoers postscript to the postscripts table. The postscript will run after the Linux installation is completed.</p>
<pre><code># chtab node=all postscripts.postscripts+=sudoer</code></pre></li>
</ol>
<p>In the example above, the sudoer postscript will be run for any node in the group <em>all</em>.</p>
<ol start="6" style="list-style-type: decimal">
<li><p>Add an entry into the xCAT passwd table to force xCAT to access and manage virtual machines by the sudoer, instead of using root.</p>
<pre><code>chtab username=xcat passwd.key=sudoer</code></pre></li>
</ol>
<p>If as entry is found in the passwd table (where key = sudoer), then xCAT will use the username when accessing any virtual machine.</p>
<ol start="7" style="list-style-type: decimal">
<li><p>By the end of this setup, you should have the following entries in the password, policy, and postscripts table.</p>
<pre><code># tabdump policy
#priority,name,host,commands,noderange,parameters,time,rule,comments,disable
&quot;1&quot;,&quot;root&quot;,,,,,,&quot;allow&quot;,,
&quot;1.2&quot;,&quot;ihost1&quot;,,,,,,&quot;trusted&quot;,,
&quot;1.3&quot;,&quot;xcat&quot;,,,,,,&quot;allow&quot;,,

# tabdump passwd
#key,username,password,cryptmethod,comments,disable
&quot;xcat&quot;,&quot;root&quot;,&quot;12JtAcMN8jn8k&quot;,,,
&quot;xcat&quot;,&quot;xcat&quot;,&quot;12JtAcMN8jn8k&quot;,,,
&quot;sudoer&quot;,&quot;xcat&quot;,,,,

# tabdump postscripts
#node,postscripts,postbootscripts,comments,disable
&quot;xcatdefaults&quot;,&quot;syslog,remoteshell,syncfiles,sudoer&quot;,&quot;setuprepo,otherpkgs&quot;,,
&quot;all&quot;,&quot;setuprepo,otherpkgs,sudoer&quot;,,,</code></pre></li>
</ol>
</body>
</html>
