<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
</head>
<body>
<div id="TOC">
<ul>
<li><a href="#overview">Overview</a><ul>
<li><a href="#postage.pm">Postage.pm</a></li>
<li><a href="#updatenode">updatenode</a></li>
<li><a href="#xcatdsklspost">xcatdsklspost</a></li>
</ul></li>
</ul>
</div>
<p><!-- START doctoc generated TOC please keep comment here to allow auto update --> <!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --> Table of Contents</p>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#postagepm">Postage.pm</a></li>
<li><a href="#updatenode">updatenode</a></li>
<li><a href="#xcatdsklspost">xcatdsklspost</a></li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->

<p>{{:Design Warning}}</p>
<h2 id="overview"><a href="#TOC">Overview</a></h2>
<p>There is a requirement to allow updatenode to run postscripts/postbootscripts that are defined in the osimage table and not automatically run the xCAT default postscripts and/or the postscripts defined for the node in the postscripts table. Note this is being implemented in 2.8 as an internal function. The next sections list the changes required.</p>
<h3 id="postage.pm"><a href="#TOC">Postage.pm</a></h3>
<p>Postage.pm will be changed to build a new mypostscript file with multiple sections based on where they were defined in the database. The changes start at the line # postscripts-start-here in the current file.</p>
<pre><code>          .
          .
          .
#postscripts-start-here 
#defaults-postscripts-start-here    
run_ps postscript1
       .
#defaults-postscripts-end-here
#osimage-postscripts-start-here
run_ps postscript2
       .
#osimage-postscripts-end-here
#node-postscripts-start-here
run_ps postscript3
       .
#node-postscripts-end-here
#postscripts-end-here 
#postbootscripts-start-here  
#defaults-postbootscripts-start-here
run_ps postbootscript1
       .
#defaults-postbootscripts-end-here
#osimage-postbootscripts-start-here
run_ps postbootscript2
       .
#osimage-postbootscripts-end-here
#node-postbootscripts-start-here
run_ps postbootscript3
        .
#node-postbootscripts-end-here
#postbootscripts-end-here</code></pre>
<h3 id="updatenode"><a href="#TOC">updatenode</a></h3>
<p>updatenode will take on the -P flag, as if a postscript name the title a section of the new mypostscript file. It will pass this section name to xcatdsklspost which will build a correct mypostscript file containing only the postscript from the section designated. Only one sections can be selected at a time. Note the long name is to try and not conflict with any previously defined postscripts, created by users.</p>
<p>To run all the postscripts, all sections</p>
<pre><code>updatenode &amp;lt;noderange&amp;gt; -P postscripts-start-here</code></pre>
<p>To run all the postbootscripts, all sections</p>
<pre><code>updatenode &amp;lt;noderange&amp;gt; -P postbootscripts-start-here</code></pre>
<p>To run only the postbootscripts defined in the osimage postbootscripts attribute</p>
<pre><code>updatenode &amp;lt;noderange&amp;gt; -P osimage-postbootscripts-start-here</code></pre>
<h3 id="xcatdsklspost"><a href="#TOC">xcatdsklspost</a></h3>
<p>xcatdsklspost will be change to recognize the new postscripts/postbootscripts name in the above section. Based on that name modify the mypostscript file created by Postage.pm and create a new mypostscript file with only the required postscript/postbootscripts.</p>
</body>
</html>
