<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
</head>
<body>
<div id="TOC">
<ul>
<li><a href="#on-aix-71b">On AIX 71B:</a></li>
<li><a href="#xcat-data-object-stanza-file">&lt;xCAT data object stanza file&gt;</a></li>
<li><a href="#xcat-data-object-stanza-file-1">&lt;xCAT data object stanza file&gt;</a></li>
<li><a href="#on-rhel6">On RHEL6:</a><ul>
<li><a href="#preparation">Preparation:</a></li>
<li><a href="#steps">Steps:</a></li>
</ul></li>
<li><a href="#xcat-data-object-stanza-file-2">&lt;xCAT data object stanza file&gt;</a></li>
<li><a href="#tabdump-site-grep-dhcp">tabdump site | grep dhcp</a></li>
</ul>
</div>
<p><!-- START doctoc generated TOC please keep comment here to allow auto update --> <!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --> Table of Contents</p>
<ul>
<li><a href="#on-aix-71b">On AIX 71B:</a></li>
<li><a href="#&amp;ltxcat-data-object-stanza-file&amp;gt">&lt;xCAT data object stanza file&gt;</a></li>
<li><a href="#&amp;ltxcat-data-object-stanza-file&amp;gt-1">&lt;xCAT data object stanza file&gt;</a></li>
<li><a href="#on-rhel6">On RHEL6:</a></li>
<li><a href="#preparation">Preparation:</a></li>
<li><a href="#steps">Steps:</a></li>
<li><a href="#&amp;ltxcat-data-object-stanza-file&amp;gt-2">&lt;xCAT data object stanza file&gt;</a></li>
<li><a href="#tabdump-site-%7C-grep-dhcp">tabdump site | grep dhcp</a></li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->

<p>This guide describes the initial iteration of the xCAT support for booting AIX and Linux diskless node over an HFI network.</p>
<h1 id="on-aix-71b"><a href="#TOC">On AIX 71B:</a></h1>
<p>1. Install xCAT and DB2 on AIX management node.</p>
<p>1). Install and configure an xCAT management node. See the following xCAT document for details:</p>
<p>[XCAT_AIX_Cluster_Overview_and_Mgmt_Node]</p>
<p>2)HPC requires a Hierarchical cluster, the DB2 database and the HPC software, refer to the following document. [Setting_Up_an_AIX_Hierarchical_Cluster]</p>
<p>3)To setup the hardware and create the hardware connections between management node and BPA/FSPs in PERCS without HMC, please contact IBM to get the latest hardware server, fsp-api builds and instructions.</p>
<p>4). To use HPC software, you need to install additional xCAT package which is not installed by default. The package is distributed in xCAT-core tarball:</p>
<p>rpm -Uvh xCAT-IBMhpc*.rpm</p>
<p>2. Download HFI packages</p>
<p>There are several separate packages required for boot over HFI including NIM server/HFI device driver/xCAT scripts. Contact IBM.</p>
<p>In this example, we assume all the packages have been downloaded and extracted to /hfi folder on management node.</p>
<p>3. Update the /etc/hosts file</p>
<p>The examples in this guide assume the following IP addresses and hostnames.</p>
<p>10.0.0.208 c250mgrs03-pvt //management node</p>
<p>10.7.2.5 c250f07c02ap05.ppd.pok.ibm.com c250f07c02ap05 //host name and IP of the ethernet network interface on service node.</p>
<p>20.7.2.5 c250f07c02ap05-hf0.ppd.pok.ibm.com c250f07c02ap05-hf0 //service node</p>
<p>21.7.2.5 c250f07c02ap05-hf1.ppd.pok.ibm.com c250f07c02ap05-hf1 //service node</p>
<p>22.7.2.5 c250f07c02ap05-hf2.ppd.pok.ibm.com c250f07c02ap05-hf2 //service node</p>
<p>23.7.2.5 c250f07c02ap05-hf3.ppd.pok.ibm.com c250f07c02ap05-hf3 //service node</p>
<p>20.7.2.9 c250f07c02ap09-hf0.ppd.pok.ibm.com c250f07c02ap09-hf0 //compute node</p>
<p>21.7.2.9 c250f07c02ap09-hf1.ppd.pok.ibm.com c250f07c02ap09-hf1 //compute node</p>
<p>22.7.2.9 c250f07c02ap09-hf2.ppd.pok.ibm.com c250f07c02ap09-hf2 //compute node</p>
<p>23.7.2.9 c250f07c02ap09-hf3.ppd.pok.ibm.com c250f07c02ap09-hf3 //compute node</p>
<p>Make sure /etc/hosts on Management node contains hostnames for the ethernet interface and the HFI interface for the service node(s).</p>
<p>4. Define the service node and compute node</p>
<p>If there is no HMC configured to manage the Power 775 hardwares, you have to define the service nodes and compute nodes manually. If the hardwares are managed by HMC, you can use xCAT command &quot;rscan&quot; to generate the compute node definition. See man page of rscan for more details.</p>
<p>This is an example of service node definition:</p>
<h1 id="xcat-data-object-stanza-file"><a href="#TOC">&lt;xCAT data object stanza file&gt;</a></h1>
<p>c250f07c02ap05:</p>
<p>objtype=node</p>
<p>arch=ppc64</p>
<p>cons=fsp</p>
<p>groups=all,service //Specify service group indicate this is a service node.</p>
<p>hcp=f07c02fsp1_a //FSP node definition that managed it.</p>
<p>id=5</p>
<p>installnic=en0</p>
<p>ip=10.7.2.5</p>
<p>mgt=fsp</p>
<p>monserver=10.0.0.208</p>
<p>nfsserver=10.0.0.208</p>
<p>nodetype=lpar,osi</p>
<p>os=AIX</p>
<p>parent=f07c02fsp1_a //Set to Fsp that manage it.</p>
<p>postbootscripts=servicenode</p>
<p>pprofile=c250f07c02ap05</p>
<p>primarynic=en0</p>
<p>provmethod=1040A_SN</p>
<p>setupconserver=0</p>
<p>setupdhcp=1</p>
<p>setupftp=1</p>
<p>setupnfs=1</p>
<p>setuptftp=1</p>
<p>tftpserver=10.0.0.208</p>
<p>xcatmaster=10.0.0.208</p>
<p>This is an example of compute nodes definition:</p>
<p>For example;</p>
<h1 id="xcat-data-object-stanza-file-1"><a href="#TOC">&lt;xCAT data object stanza file&gt;</a></h1>
<p>c250f07c02ap09-hf0:</p>
<p>objtype=node</p>
<p>arch=ppc64</p>
<p>cons=fsp</p>
<p>currchain=boot</p>
<p>currstate=boot</p>
<p>groups=lpar,all</p>
<p>hcp=Server-9125-F2C-SNP7IH019-A</p>
<p>id=9</p>
<p>ip=10.4.32.224</p>
<p>mgt=fsp</p>
<p>nodetype=lpar,osi</p>
<p>os=AIX</p>
<p>parent=Server-9458-100-SNBPCF007-A</p>
<p>pprofile=xcatnode9</p>
<p>servicenode=c250f07c02ap05</p>
<p>xcatmaster=c250f07c02ap05-hf0</p>
<p>You can put the definition into one stanza file and import it to xCAT with the mkdef xCAT command.</p>
<p>cat /percs/hfi/c250f07c02ap09-hf0.stanza | mkdef -z</p>
<p>5. Install service node(s) and install HFI device drivers and NIM to service node(s).</p>
<p>1). Create NIM image for service node</p>
<p>mknimimage -s /percs/aiximages/aix/ 1040A_SN</p>
<p>where /install/aiximages/1040a/aix/ contains the AIX image.</p>
<p>// If there are existing resource, you can specify the resource type and value as an option of mknimimage so mknimimage will not create same resource type. For example you have copied one lpp_source &quot;1040A_SN_lpp_source&quot; to /install/nim/lpp_source and created NIM lpp source &quot;1040A_SN_lpp_source&quot; then you can just use it to avoiding creating new lpp_source with command:</p>
<p>mknimimage -s /install/aiximages/1040a/aix/ 1040A_SN lpp_source=1040A_SN_lpp_source spot=1040A_SN -f</p>
<p>2). Add required service node software</p>
<p>Following steps add the HFI device driver, replace the NIM with new version, and replace the bootpd birnay for HFI support. Please aware that this software is to work with HFI support, there are still other software needed to be installed on service node, please check the following doc:</p>
<p>[Setting_Up_an_AIX_Hierarchical_Cluster]</p>
<p>3). Update the HFI device driver to lpp source</p>
<p>inutoc /hfi/dd/</p>
<p>nim -o update -a packages=all -a source=/hfi/dd/ 1040A_SN_lpp_source</p>
<p>4). Define HFI device driver installp bundle</p>
<p>nim -o define -t installp_bundle -a server=master -a location=/hfi/dd/xCATaixHFIdd.bnd xCATaixHFIdd</p>
<p>5). Assign HFI devices drivers isntallp bundle to service node image so they will be installed during service node installation.</p>
<p>chdef -t osimage -o 1040A_SN installp_bundle=xCATaixHFIdd,xCATaixSN71</p>
<p>Where installp_bundle should have been defined when installing required service node software.</p>
<p>6). Configure HFI interfaces with postscript</p>
<p>cp /hfi/scripts/confighfi /install/postscripts/</p>
<p>cp /hfi/scripts/confignim /install/postscripts/</p>
<p>chdef -t osimage -o 1040A_SN synclists=/hfi/scripts/synclist</p>
<p>chdef c250f07c02ap05 postscripts=confighfi,confignim</p>
<p>7). If you are using an existing NIM resource including HPC softwares, two steps needs to be done to automatically install and configure the HPC softwares</p>
<ol style="list-style-type: lower-alpha">
<li>Create installp bundles which specified what are HPC softwares need to be installed:</li>
</ol>
<p>mkdir -p /install/nim/installp_bundle</p>
<p>cp /opt/xcat/share/xcat/IBMhpc/IBMhpc_base.bnd /install/nim/installp_bundle</p>
<p>nim -o define -t installp_bundle -a server=master -a</p>
<p>location=/install/nim/installp_bundle/IBMhpc_base.bnd IBMhpc_base</p>
<p>cp /opt/xcat/share/xcat/IBMhpc/IBMhpc_all.bnd /install/nim/installp_bundle</p>
<p>nim -o define -t installp_bundle -a server=master -a</p>
<p>location=/install/nim/installp_bundle/IBMhpc_all.bnd IBMhpc_all</p>
<p>chdef -t osimage -o 1040A_SN</p>
<p>installp_bundle=&quot;xCATaixHFIdd,xCATaixSN71,IBMhpc_base,IBMhpc_all&quot;</p>
<p>b). Assign the postscripts to service node to configure the HPC softwares automatically.</p>
<p>cp -p /opt/xcat/share/xcat/IBMhpc/IBMhpc.postbootscript /install/postscripts</p>
<p>cp -p /opt/xcat/share/xcat/IBMhpc/IBMhpc.postscript /install/postscripts</p>
<p>cp -p /opt/xcat/share/xcat/IBMhpc/gpfs/gpfs_updates /install/postscripts</p>
<p>cp -p /opt/xcat/share/xcat/IBMhpc/compilers/compilers_license /install/postscripts</p>
<p>cp -p /opt/xcat/share/xcat/IBMhpc/pe/pe_install /install/postscripts</p>
<p>cp -p /opt/xcat/share/xcat/IBMhpc/essl/essl_install /install/postscripts</p>
<p>cp -p /opt/xcat/share/xcat/IBMhpc/loadl/loadl_install /install/postscripts</p>
<p>chdef c250f07c02ap05 postscripts=confighfi,confignim,IBMhpc.postbootscript</p>
<p>For more details and steps about HPC integration, please review following page:</p>
<p>[Setting_up_all_IBM_HPC_products_in_a_Stateful_Cluster]</p>
<p>8). Then follow the Hiearchical setup document starting from &quot;Define xCAT networks&quot; to install service node.</p>
<p>[Setting_Up_an_AIX_Hierarchical_Cluster]</p>
<p>9). Check if HFI interfaces are up after service node is setup.</p>
<p>xdsh c250f07c02ap05 ifconfig hf0</p>
<p>6. Create a diskless image for the compute nodes.</p>
<p>Create a diskless image:</p>
<p>mknimimage -V -f -r -t diskless -s /percs/aiximages/aix 1040A_CN</p>
<p>- where /install/AIX71GOLD/ contains the AIX 710 GOLD source images.</p>
<p>// Same as diskfull images creation, if there are existing resource, you can specify the resource type and value as an option of mknimimage so mknimimage will not create same resource type. For example, you have copied one lpp_source 1040A_CN_lpp_source to /install/nim/lpp_source, then you can just use it to avoiding creating new lpp_source with command:</p>
<p>mknimimage -V -f -r -t diskless -s /install/AIX71GOLD/ 1040A_CNlpp_source=1040A_CN_lpp_source spot=1040A_CN 1040A_CN</p>
<p>7. Update the spot</p>
<p>Note: Skip this step if you are using the existing image including HFP softwares since all the packages have been updated into the image</p>
<p>See sections 4.2.1 (Update options) and section 4.2.2 &quot;Adding required software&quot; in the xCAT document &quot;Using xCAT Service Nodes with AIX&quot; to add necessary software to spot:</p>
<p>[Setting_Up_an_AIX_Hierarchical_Cluster]</p>
<p>8. Create an xCAT HFI network definition</p>
<p>Run a command similar to the following:</p>
<p>mkdef -t network -o hfinet net=20.0.0.0 mask=255.0.0.0 gateway=20.7.2.5</p>
<p>9. Install HFI device driver into spot</p>
<p>(Skip this step if you are using the existing image including HFP softwares since all the packages have been updated)</p>
<p>Install the HFI device driver into the spot on the management node.</p>
<p>inutoc /hfi/dd/</p>
<p>nim -o update -a packages=all -a source=/hfi/dd 1040A_CN_lpp_source</p>
<p>where: /percs/hfi/dd contains the HFI device driver installp packages.</p>
<p>chdef -t osimage -o 1040A_CN installp_bundle=&quot;xCATaixHFIdd,xCATaixCN71&quot;</p>
<p>Where xCATaixCN71 should have been defined when add the additional softwares into spot.</p>
<p>mknimimage -u 1040A_CN</p>
<p>10. synchronize /etc/hosts to SPOT to bring up all the HFI interfaces on compute nodes</p>
<p>chdef -t osimage -o 1040A_CN synclists=/hfi/scripts/synclist</p>
<p>mknimimage -u 1040A_CN</p>
<p>11. If you are using the existing NIM resource including HPC softwares, you need to assign the postscripts to computes node to configure the HPC softwares automatically.(Optional)</p>
<p>chdef c250f07c02ap09-hf0 postscripts=IBMhpc.postbootscript</p>
<p>12. Initialize console for the compute node.</p>
<p>makeconservercf</p>
<p>13. Add confighfi postscript to compute node to config HFI interfaces automatically.</p>
<p>cp /hfi/scripts/confighfi /install/postscripts/</p>
<p>chdef c250f07c02ap09-hf0 postscripts=confighfi,IBMhpc.postbootscript</p>
<p>Notes: remove the IBMhpc.postbootscript if you are not using a diskless image with HPC softwares.</p>
<p>14. Get the MAC address of the compute node</p>
<p>getmacs c250f07c02ap09-hf0 -D --hfi</p>
<p>15. Initialize the AIX/NIM diskless nodes</p>
<p>mkdsklsnode -i 1040A_CN c250f07c02ap09-hf0 --hfi -f -V</p>
<p>16. Open remote console</p>
<p>Open another window, login to the management node (ih1901) and run the following command to watch the installation from the console:</p>
<p>rcons c250f07c02ap09-hf0</p>
<p>17. Boot the compute node</p>
<p>rnetboot c250f07c02ap09-hf0 --hfi</p>
<h1 id="on-rhel6"><a href="#TOC">On RHEL6:</a></h1>
<h2 id="preparation"><a href="#TOC">Preparation:</a></h2>
<p>1. We are using following nodes as an example in all the steps:</p>
<p>MN: c250mgrs04-pvt</p>
<p>SN: c250f07c04ap01</p>
<p>CN: c250f07c04ap13</p>
<p>2. All the steps are running on xCAT management node. For those commands running on server node, we are using xdsh to the service nodes to run the commands parallized.</p>
<p>3. We assume all the HFI device driver and DHCP server/client packages has been extrated to /hfi directory on xCAT MN.</p>
<h2 id="steps"><a href="#TOC">Steps:</a></h2>
<p>1. After installing xCAT, increase the /boot file system size for service node since we need to use a customized kernel on service node, there will be two kernels existing on service nodes, /boot needs more space.</p>
<p>This is just for workarounds of customized kernel. After the kernel is accepted by Linux community, there will be only one kernel existing on service node, and we don't need to increase the /boot space at that time.</p>
<p>Change file /opt/xcat/share/xcat/install/rh/service.rhels6.ppc64.tmpl, search the line:</p>
<p>From:</p>
<p>part /boot --size 50 --fstype ext4</p>
<p>To:</p>
<p>part /boot --size 200 --fstype ext4</p>
<p>2. Follow the xCAT MN ans SN setup document to setup xCAT MN and install service nodes. xCAT2pLinux.pdf and xCAT2SetupHierarchy.pdf</p>
<p>3. Install the HFI device drivers on xCAT MN</p>
<p>rpm -ivh kernel-2.6.32hfi-3.ppc64.rpm</p>
<p>rpm -ivh --nodeps hfi_util-1.0-0.el6.ppc64.rpm</p>
<p>rpm -ivh --force net-tools-1.60-102.el6.ppc64.rpm</p>
<p>4. Configure xCAT SN with HFI device driver and new DHCP server/client</p>
<ol style="list-style-type: decimal">
<li>Create folders on service node and copy the HFI driver and DHCP packages to service node:</li>
</ol>
<p>xdcp c250f07c04ap01 -R /hfi /hfi</p>
<ol start="2" style="list-style-type: decimal">
<li>Install the HFI device drivers and DHCP server for xCAT SN</li>
</ol>
<p>xdsh c250f07c04ap01 rpm -ivh /hfi/dd/kernel-2.6.32hfi-2.ppc64.rpm</p>
<p>xdsh c250f07c04ap01 rpm -ivh --nodeps /hfi/dd/hfi_util-1.0-0.el6.ppc64.rpm</p>
<p>xdsh c250f07c04ap01 rpm -ivh --force /hfi/dd/net-tools-1.60-102.el6.ppc64.rpm</p>
<p>xdsh c250f07c04ap01 /sbin/new-kernel-pkg --mkinitrd --depmod --install 2.6.32hfi</p>
<p>xdsh c250f07c04ap01 /sbin/new-kernel-pkg --rpmposttrans 2.6.32hfi</p>
<ol start="3" style="list-style-type: decimal">
<li>Create softlink and change yaboot.conf to boot from the customized kernel with HFI support</li>
</ol>
<p>xdsh c250f07c04ap01 ln -sf /boot/vmlinuz-2.6.32hfi /boot/vmlinuz</p>
<p>xdsh c250f07c04ap01 ln -sf /boot/System.map-2.6.32hfi /boot/System.map</p>
<p>Login to service node, change the &quot;default=&quot; setting to the new label with HFI support, for example:</p>
<p>Change from:</p>
<p>boot=/dev/sda1</p>
<p>init-message=&quot;Welcome to Red Hat Enterprise Linux!&lt;TAB&gt; for boot options&quot;</p>
<p>partition=3</p>
<p>timeout=5</p>
<p>install=/usr/lib/yaboot/yaboot</p>
<p>delay=5</p>
<p>enablecdboot</p>
<p>enableofboot</p>
<p>enablenetboot</p>
<p>nonvram</p>
<p>fstype=raw</p>
<p>default=linux</p>
<p>image=/vmlinuz-2.6.32hfi</p>
<p>label=2.6.32hfi</p>
<p>read-only</p>
<p>initrd=/initrd-2.6.32hfi.img</p>
<p>append=&quot;rd_NO_LUKS rd_NO_LVM rd_NO_MD rd_NO_DM LANG=en_US.UTF-8 SYSFONT=latarcyrhebsun16 KEYTABLE=us console=hvc0 crashkernel=auto rhgb quiet root=UUID=e2123609-7080-45f0-b583-23d5ef27dbba&quot;</p>
<p>image=/vmlinuz-2.6.32-71.el6.ppc64</p>
<p>label=linux</p>
<p>read-only</p>
<p>initrd=/initramfs-2.6.32-71.el6.ppc64.img</p>
<p>append=&quot;rd_NO_LUKS rd_NO_LVM rd_NO_MD rd_NO_DM LANG=en_US.UTF-8 SYSFONT=latarcyrhebsun16 KEYTABLE=us console=hvc0 crashkernel=auto rhgb quiet root=UUID=e2123609-7080-45f0-b583-23d5ef27dbba&quot;</p>
<p>TO:</p>
<p>boot=/dev/sda1</p>
<p>init-message=&quot;Welcome to Red Hat Enterprise Linux!&lt;TAB&gt; for boot options&quot;</p>
<p>partition=3</p>
<p>timeout=5</p>
<p>install=/usr/lib/yaboot/yaboot</p>
<p>delay=5</p>
<p>enablecdboot</p>
<p>enableofboot</p>
<p>enablenetboot</p>
<p>nonvram</p>
<p>fstype=raw</p>
<p>default=2.6.32hfi</p>
<p>image=/vmlinuz-2.6.32hfi</p>
<p>label=2.6.32hfi</p>
<p>read-only</p>
<p>initrd=/initrd-2.6.32hfi.img</p>
<p>append=&quot;rd_NO_LUKS rd_NO_LVM rd_NO_MD rd_NO_DM LANG=en_US.UTF-8 SYSFONT=latarcyrhebsun16 KEYTABLE=us console=hvc0 crashkernel=auto rhgb quiet root=UUID=e2123609-7080-45f0-b583-23d5ef27dbba&quot;</p>
<p>image=/vmlinuz-2.6.32-71.el6.ppc64</p>
<p>label=linux</p>
<p>read-only</p>
<p>initrd=/initramfs-2.6.32-71.el6.ppc64.img</p>
<p>append=&quot;rd_NO_LUKS rd_NO_LVM rd_NO_MD rd_NO_DM LANG=en_US.UTF-8 SYSFONT=latarcyrhebsun16 KEYTABLE=us console=hvc0 crashkernel=auto rhgb quiet root=UUID=e2123609-7080-45f0-b583-23d5ef27dbba&quot;</p>
<ol start="4" style="list-style-type: decimal">
<li>Reset service nodes to boot from kernel with HFI</li>
</ol>
<p>xdsh c250f07c04ap01 reboot</p>
<p>5. Now the HFI interfaces on service nodes should be available on service node, sync the /etc/hosts</p>
<p>from MN to SN and configure HFI interfaces with IP address.</p>
<p>xdcp c250f07c04ap01 /etc/hosts /etc/hosts</p>
<p>cp /hfi/scripts/hficonfig /install/postscripts/hficonfig</p>
<p>chdef c250f07c04ap01 postscripts=servicenode,xcatserver,xcatclient,hficonfig</p>
<p>As of xCAT 2.7, xcatclient and xcatserver are called from the servicenode postscript so you should run the following:</p>
<p>chdef c250f07c04ap01 postscripts=servicenode,hficonfig</p>
<p>updatenode c250f07c04ap01</p>
<p>6. Install DHCP server/client on MN and SN.</p>
<p>rpm -Uvh /hfi/dhcp/dhcp-4.1.1-13.P1.el6.ppc64.rpm</p>
<p>rpm -Uvh /hfi/dhcp/dhclient-4.1.1-13.P1.el6.ppc64.rpm</p>
<p>xdsh c250f07c04ap01 rpm -Uvh /hfi/dhcp/dhcp-4.1.1-13.P1.el6.ppc64.rpm</p>
<p>xdsh c250f07c04ap01 rpm -Uvh /hfi/dhcp/dhclient-4.1.1-13.P1.el6.ppc64.rpm</p>
<p>7. Create new networks for HFI interface. Generally we only need to create one new HFI network for</p>
<p>installation.</p>
<p>mkdef -t network -o hfinet net=20.0.0.0 mask=255.0.0.0 gateway=20.255.255.254 mgtifname=hf0</p>
<p>dhcpserver=20.7.4.1 tftpserver=20.7.4.1 nameservers=20.7.4.1</p>
<p>8. Create compute node definitions. Make sure the servicenode and xcatmaster are setting correctly.</p>
<p>servicenode attribute should be set to the ethernet IP address or hostname on service node, and</p>
<p>xcatmaster should be set to HFI IP</p>
<p>address on service node.</p>
<h1 id="xcat-data-object-stanza-file-2"><a href="#TOC">&lt;xCAT data object stanza file&gt;</a></h1>
<p>c250f07c04ap13:</p>
<p>objtype=node</p>
<p>arch=ppc64</p>
<p>cons=fsp</p>
<p>groups=lpar,all</p>
<p>hcp=f07c04fsp1_a</p>
<p>id=13</p>
<p>installnic=hf0</p>
<p>ip=20.7.4.13</p>
<p>mgt=fsp</p>
<p>monserver=20.7.4.1</p>
<p>netboot=yaboot</p>
<p>nfsserver=20.7.4.1</p>
<p>nodetype=lpar,osi</p>
<p>os=rhels6</p>
<p>parent=f07c04fsp1_a</p>
<p>postscripts=hficonfig</p>
<p>pprofile=c250f07c04ap13</p>
<p>primarynic=hf0</p>
<p>profile=compute</p>
<p>provmethod=netboot</p>
<p>servicenode=10.7.4.1</p>
<p>tftpserver=20.7.4.1</p>
<p>xcatmaster=20.7.4.1</p>
<p>9. Create diskless images</p>
<p>copycds -n rhels6 /iso/RHEL6.0-20100922.1-Server-ppc64-DVD1.iso</p>
<p>Where rhels6 stands for the OS version.</p>
<p>10. The HFI kernel can be installed by xCAT automatically, but another two packages hfi_util and nettools required rpm --force or --nodeps options, xCAT cannot handle the options automatically. So we need to modify the postinstall file manually which will be run during diskless image generation.</p>
<p>Add following lines to /opt/xcat/share/xcat/netboot/rh/compute.rhels6.ppc64.postinstall</p>
<p>//rhels6 stands for the OS version, it should be the same as name in step 8.</p>
<p>cp /hfi/dd/hfi_util-1.0-0.el6.ppc64.rpm /install/netboot/rhels6/ppc64/compute/rootimg/tmp/hfi_util-1.0-0.el6.ppc64.rpm</p>
<p>cp /hfi/dd/net-tools-1.60-102.el6.ppc64.rpm /install/netboot/rhels6/ppc64/compute/rootimg/tmp/nettools-1.60-102.el6.ppc64.rpm</p>
<p>cp /hfi/dhcp/dhclient-4.1.1-13.P1.el6.ppc64.rpm /install/netboot/rhels6/ppc64/compute/rootimg/tmp/dhclient-4.1.1-13.P1.el6.ppc64.rpm</p>
<p>cp /hfi/dhcp/dhcp-4.1.1-13.P1.el6.ppc64.rpm /install/netboot/rhels6/ppc64/compute/rootimg/tmp/dhcp-4.1.1-13.P1.el6.ppc64.rpm</p>
<p>chroot /install/netboot/rhels6/ppc64/compute/rootimg/ /bin/rpm -ivh /tmp/net-tools-1.60-102.el6.ppc64.rpm --force</p>
<p>chroot /install/netboot/rhels6/ppc64/compute/rootimg/ /bin/rpm -ivh /tmp/hfi_util-1.0-0.el6.ppc64.rpm --nodeps --force</p>
<p>chroot /install/netboot/rhels6/ppc64/compute/rootimg/ /bin/rpm -Uvh /tmp/dhclient-4.1.1-13.P1.el6.ppc64.rpm --force</p>
<p>chroot /install/netboot/rhels6/ppc64/compute/rootimg/ /bin/rpm -Uvh /tmp/dhcp-4.1.1-13.P1.el6.ppc64.rpm --force</p>
<p>11. Sync the /etc/hosts to diskless image. This is used for the postscript hficonfig to configure all the HFI interfaces on compute nodes.</p>
<p>cp /hfi/scripts/compute.rhels6.ppc64.synclist</p>
<p>/install/custom/netboot/rh/compute.rhels6.ppc64.synclist</p>
<p>12. Generate the diskless images</p>
<p>cd /opt/xcat/share/xcat/netboot/rh/ &amp;&amp; /opt/xcat/share/xcat/netboot/rh/genimage -i hf0 -n hf_if -o rhels6 -p compute -k 2.6.32hfi</p>
<p>where hf0 stands for the boot interface on compute nodes, and hf_hf stands for the boot devices.</p>
<p>13. pack the image:</p>
<p>packimage -o rhels6 -p compute -a ppc64</p>
<p>14. Get the compute node mac address and setup dhcp services.</p>
<p>getmacs c250f07c04ap13 --hfi -D</p>
<p>//Make sure your site table have setup dhcp server on MN and SN correctly.</p>
<h1 id="tabdump-site-grep-dhcp"><a href="#TOC">tabdump site | grep dhcp</a></h1>
<p>&quot;dhcpinterfaces&quot;,&quot;c250mgrs04-pvt|eth0;c250f07c04ap01|hf0&quot;,,</p>
<p>//Issue makedhcp to setup dhcp services. Specify --HFI option to identify this is a HFI devices.</p>
<p>makedhcp c250f07c04ap13 --HFI</p>
<p>15. Initialized the boot</p>
<p>nodeset c250f07c04ap13 netboot</p>
<p>16. Reboot the node to boot from network.</p>
<p>rnetboot c250f07c04ap13 --hfi</p>
<p>17. Open a console to watch the compute node installation.</p>
<p>rcons c250f07c04ap13</p>
</body>
</html>
